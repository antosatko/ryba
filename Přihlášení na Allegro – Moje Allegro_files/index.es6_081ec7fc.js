const e="cart",t="FIRST_IN_CART",r={CART_CAPACITY_EXCEEDED:"OFFER_CART_CAPACITY_EXCEEDED"},i="application/vnd.allegro.public.v5+json",a=({code:e})=>{const{CART_CAPACITY_EXCEEDED:t}=r;return e===t},s=e=>t=>window.opbox.edge.post("/carts/changeQuantityCommand",{items:t},{headers:{Accept:i,"Content-Type":i},withCredentials:!0}).catch((({status:t,data:r})=>{if(422===t&&r&&r.errors&&r.errors.find(a))return window.location.assign(`/${e}?error=CART_CAPACITY_EXCEEDED`);throw Error(`Failed to add to cart. Status: ${t}. Data: ${JSON.stringify(r)}.`)})),n="application/vnd.allegro.internal.v6+json",d="application/vnd.allegro.internal.v7+json",o=e=>({items:i,position:a=t})=>window.opbox.edge.post("/carts/items",{items:i,position:a},{headers:{Accept:d,"Content-Type":d},withCredentials:!0}).then((t=>{const{data:i}=t,{CART_CAPACITY_EXCEEDED:a}=r;let s=!1;return i.items.filter((e=>{var t;return(null==e||null==(t=e.errors)?void 0:t.length)>0})).forEach((e=>{e.errors.find((e=>e.code===a))&&(s=!0)})),s?window.location.assign(`/${e}?error=CART_CAPACITY_EXCEEDED`):t})).catch((({status:e,data:t})=>{if(t.errors&&t.errors.length>0)throw Error("Failed to add to cart. "+t.errors[0].message);throw Error(`Failed to add to cart. Status: ${e}. Data: ${JSON.stringify(t)}.`)})),l=e=>window.opbox.edge.delete("/cart/items?ids="+e.join(","),{headers:{Accept:"application/vnd.allegro.internal.v1+json"},withCredentials:!0}),h=e=>window.opbox.edge.put("/carts/items/quantity",e,{headers:{Accept:d,"Content-Type":d},withCredentials:!0}),c=()=>window.opbox.edge.get("/carts",{headers:{Accept:n,"Content-Type":n},withCredentials:!0}),p=Error("Failed to render precart layer"),g={showPrecartLayer:!1},{cartConfiguration:u}=(({pluginName:e,clientImplementationVersion:t})=>{try{return JSON.parse(window.document.querySelector(`script[data-serialize-plugin-name="${e}"][data-civ="${t}"]`).textContent)}catch(r){return window.opbox.reportError(Error(`Missing serialized props of plugin "${e}", with civ "${t}"`)),{}}})({pluginName:e,clientImplementationVersion:"81d"});u&&window.opbox.plugin.register({name:e},new class{constructor({window:e,props:r}){this.quantityChangeListeners=void 0,this.window=void 0,this.props=void 0,this.changeQuantity=void 0,this.addOffersAPI=void 0,this.deleteOffersAPI=void 0,this.modifyItemsAPI=void 0,this.getItemsAPI=void 0,this.changeItems=(e,t,{showPrecartLayer:r}=g)=>this.changeQuantity(e).then((()=>{const i=e.reduce(((e,{delta:t})=>e+t),0),a=e.map((({itemId:e})=>e));return this.triggerQuantityChangeListeners(i,a),r?this.window.opbox.page.render.fragment({pathname:this.props.precartLayerUrl,additionalQueryParameters:t}).catch((()=>{this.window.opbox.reportError(p)})):Promise.resolve()})).catch((e=>{throw this.window.opbox.reportError(e),e})),this.addItems=(e,r=t,i=g)=>this.addOffersAPI({items:e.map((e=>{var t,r,i,a;return{offerId:e.offerId,bundleId:null==e?void 0:e.bundleId,quantity:e.quantity,navigationCategory:null!=(t=e.category)&&t.id&&null!=(r=e.category)&&r.tree?{id:null==(i=e.category)?void 0:i.id,treeName:null==(a=e.category)?void 0:a.tree}:null}})),position:r}).then((t=>{var r;const{data:a}=t,s=a.items.reduce(((e,t)=>e+t.addedQuantity),0);this.triggerQuantityChangeListeners(s);const n=null==(r=e[0])?void 0:r.sellerId,d=e.map((({offerId:e})=>e))||[];var o;return null!=i&&i.showPrecartLayer&&this.isSellerIdValidForPrecartLayer(n)&&d.length?this.window.opbox.page.render.fragment({pathname:this.props.precartLayerUrl,additionalQueryParameters:Object.assign(Object.assign(Object.assign({precartOfferId:d},n&&{precartSellerId:n}),(null==(o=e[0])?void 0:o.bundleId)&&{rebateId:e[0].bundleId}),{},{itemQuantity:e.map((({itemId:e,quantity:t})=>`${e}:${t}`))})}).catch((()=>{this.window.opbox.reportError(p)})):Promise.resolve()})).catch((e=>{throw this.window.opbox.reportError(e),e})),this.modifyItems=e=>this.modifyItemsAPI(e),this.deleteItems=e=>this.deleteOffersAPI(e),this.getItems=()=>this.getItemsAPI(),this.addOffer=(e,t)=>this.addOffers([e],t),this.addOffers=(e,t)=>this.changeItems(e.map((({itemId:e,quantity:t,sellerId:r,category:i})=>({itemId:e,delta:t,sellerId:r,navCategoryId:i&&i.id,navTree:i&&i.tree}))),{precartOfferId:e.map((({itemId:e})=>e)),precartSellerId:e[0].sellerId,itemQuantity:e.map((({itemId:e,quantity:t})=>`${e}:${t}`))},t),this.removeOffer=({itemId:e,quantity:t,sellerId:r,allowDelete:i})=>this.changeItems([Object.assign({itemId:e,delta:-1*t,sellerId:r},!0===i&&{allowDelete:i})]),this.addBundle=({bundleMainItemId:e,quantity:t,sellerId:r,rebateId:i,itemsIds:a},s)=>this.changeItems([{itemId:e,delta:t,sellerId:r,rebateId:i}],{precartOfferId:a,precartSellerId:r,rebateId:i,quantity:t.toString(10)},s),this.triggerQuantityChangeListeners=(e,t)=>{this.quantityChangeListeners.forEach((r=>r(e,t)))},this.registerQuantityChangeListener=e=>{this.quantityChangeListeners.push(e)},this.unregisterQuantityChangeListener=e=>{this.quantityChangeListeners=this.quantityChangeListeners.filter((t=>t!==e))},this.window=e,this.quantityChangeListeners=[],this.props=r,this.changeQuantity=s(this.getCartPathname()),this.addOffersAPI=o(this.getCartPathname()),this.deleteOffersAPI=l,this.modifyItemsAPI=h,this.getItemsAPI=c}getCartPathname(){const[,e="koszyk"]=this.props.precartLayerUrl.split("/");return e}getPublicApi(){return{addItems:this.addItems,deleteItems:this.deleteItems,modifyItems:this.modifyItems,getItems:this.getItems,addBundle:this.addBundle,addOffer:this.addOffer,addOffers:this.addOffers,removeOffer:this.removeOffer,registerQuantityChangeListener:this.registerQuantityChangeListener,unregisterQuantityChangeListener:this.unregisterQuantityChangeListener}}isSellerIdValidForPrecartLayer(e){return!!e||""===e}}({window,props:u}).getPublicApi());
//# sourceMappingURL=index.es6_081ec7fc.js.map