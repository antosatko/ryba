const e="favorites",t="offers",r="queries",a="products",i="watchedQuery",s="watchedOffers",o="watchedProductQuery";let n=(e=>(e.FAVORITE_OFFER="favoriteOfferId",e.FAVORITE_QUERY="favoriteQueryId",e.FAVORITE_PRODUCT="favoriteProductId",e.WATCHED_QUERY="watchedQuery",e.WATCHED_PRODUCT_QUERY="watchedProductQuery",e))({}),d=(e=>(e.ADD="favoriteAdd",e.REMOVE="favoriteRemove",e))({});const c={generate(e){var t;const r=Error(e);throw null==(t=window.opbox)||t.reportError(r),r}};var u="logowanie",l="prihlaseni",p="prihlasenie";const h={"allegro-pl":u,"allegro-business-pl":u,"allegro-cz":l,"allegro-business-cz":l,"allegro-sk":p,"allegro-business-sk":p,"allegro-hu":"bejelentkezes"},v={login(e){const t=h[e];t||c.generate("Unsupported marketplace: "+e);const{pathname:r,search:a}=window.location;var i;window.location.assign(`/${t}?origin_url=${i=r+a,window.encodeURIComponent(i)}`)}};var g="application/vnd.allegro.public.v1+json",m="application/vnd.allegro.public.v2+json";const y={withCredentials:!0},f=e=>Object.assign(Object.assign({},y),{},{headers:{Accept:e,"Content-Type":e}}),w=(e,t,r)=>window.opbox.edge.post(e,t,f(r)),I=(e,t)=>window.opbox.edge.delete(e,f(t)),R="OFFER",O="QUERY",F="PRODUCT";class E{constructor(e,n){this.favoriteType=void 0,this.payload=void 0,this.recordId=void 0,this.favoriteType=(e=>({[t]:R,[s]:R,[r]:O,[i]:O,[a]:F,[o]:F}[e]))(e),"string"==typeof n?this.recordId=n:this.payload=n}async add(){if(!this.payload)return c.generate("Add failure - recordData is missing");switch(this.favoriteType){case O:return this.addQuery();case R:return this.addOffer();case F:return this.addProduct();default:return c.generate("Add failure - unsupported type: "+this.favoriteType)}}async remove(){if(!this.recordId)return c.generate("Remove failure - id is missing");switch(this.favoriteType){case O:return(({queryId:e})=>I("/web-edge/watched-queries/"+e,g))({queryId:this.recordId});case R:return(({offerId:e})=>I("/watched/offers/"+e,m))({offerId:this.recordId});case F:return(({queryId:e})=>I("/web-edge/watched-product-queries/"+e,g))({queryId:this.recordId});default:return c.generate("Remove failure - unsupported type: "+this.favoriteType)}}async checkup(){if(!this.payload)return Promise.reject();switch(this.favoriteType){case O:return(({queryUrl:e})=>w("/web-edge/is-watched-query",{url:e},g))({queryUrl:this.payload.value});case F:return(({productId:e,params:t})=>w("/web-edge/is-watched-product-query",Object.assign({productId:e},t),g))({productId:this.payload.value,params:this.payload.params});default:return c.generate("Checkup failure - unsupported type: "+this.favoriteType)}}async addQuery(){var e;return null!=(e=this.payload)&&e.value?(({queryUrl:e})=>w("/web-edge/watched-queries/",{url:e},g))({queryUrl:this.payload.value}):c.generate("Add failure - url is missing")}async addOffer(){var e;return null!=(e=this.payload)&&e.value?(async({offerId:e})=>{const t=await(r="/watched/offers/"+e,a=m,window.opbox.edge.put(r,void 0,f(a)));var r,a;return Object.assign(Object.assign({},t),{},{data:{id:e}})})({offerId:this.payload.value}):c.generate("Add failure - itemId is missing")}async addProduct(){var e;return null!=(e=this.payload)&&e.value?(({productId:e,params:t})=>w("/web-edge/watched-product-queries",Object.assign({productId:e},t),g))({productId:this.payload.value,params:this.payload.params}):c.generate("Add failure - productId is missing")}}const b={[t]:n.FAVORITE_OFFER,[r]:n.FAVORITE_QUERY,[a]:n.FAVORITE_PRODUCT},P={saveItem(e,t){try{return window.localStorage.setItem(b[e],JSON.stringify(t)),Promise.resolve(!0)}catch(r){return Promise.resolve(!1)}},loadItem(e){const t=JSON.parse(window.localStorage.getItem(b[e])||"{}");return Promise.resolve(t)},removeItem(e){return window.localStorage.removeItem(b[e]),Promise.resolve(!0)}},T=(({pluginName:e,clientImplementationVersion:t})=>{try{return JSON.parse(window.document.querySelector(`script[data-serialize-plugin-name="${e}"][data-civ="${t}"]`).textContent)}catch(c){return window.opbox.reportError(Error(`Missing serialized props of plugin "${e}", with civ "${t}"`)),{}}})({pluginName:e,clientImplementationVersion:"04a"});T&&window.opbox.plugin.register({name:e},new class{constructor({props:e}){var n=this;this.props=void 0,this.listeners=new Set,this.loginRedirectReady=void 0,this.onFavoriteStatusChange=e=>{const t="function"==typeof e;return t&&this.listeners.add(e),()=>{t&&this.listeners.delete(e)}},this.init=async()=>{const e=[t,a,r];return n.handleReLogin(e)},this.handleReLogin=async(e,t=0,r=[])=>{const a=e[t];if(!a)return r;try{if(n.props.userLoggedIn){const{itemId:e,action:t,params:i={}}=await P.loadItem(a);null!=e&&(t===d.ADD?await n.addFavorite(a,e,i):t===d.REMOVE&&await n.removeFavorite(a,e),await P.removeItem(a),r.push({mode:a,itemId:e,options:i,isFavorite:!0}))}else await P.removeItem(a)}catch(c){}return n.handleReLogin(e,t+1,r)},this.addFavorite=async(e,t,r={})=>{const a=new E(e,{value:t,params:r});return n.props.userLoggedIn?a.add().then((a=>(n.notifyStatusListeners({mode:e,itemId:t,options:r,isFavorite:!0}),a))).catch((e=>Promise.reject(e))):P.saveItem(e,{itemId:t,action:d.ADD,params:r}).then((()=>{v.login(n.props.marketplaceId)}))},this.removeFavorite=(e,t)=>{const r=new E(e,t);return this.props.userLoggedIn?r.remove().then((r=>(this.notifyStatusListeners({mode:e,itemId:t,isFavorite:!1}),r))).catch((r=>401===r.status?P.saveItem(e,{itemId:t,action:d.REMOVE}).then((()=>v.login(this.props.marketplaceId))):Promise.reject(r))):Promise.reject()},this.checkupFavorite=(e,t,r={})=>this.props.userLoggedIn?new E(e,{value:t,params:r}).checkup():Promise.reject(),this.getPublicApi=()=>({mode:{Offers:t,Queries:r,Products:a,WatchedQuery:i,WatchedOffers:s,WatchedProductQuery:o},addFavorite:this.addFavorite,removeFavorite:this.removeFavorite,checkupFavorite:this.checkupFavorite,onFavoriteStatusChange:this.onFavoriteStatusChange,loginRedirectReady:this.loginRedirectReady}),this.props=e,this.loginRedirectReady=new Promise((e=>{this.init().then((t=>{t.length>0&&e(t)}))}))}notifyStatusListeners(e){this.listeners.forEach((t=>{t(e)}))}}({props:T}).getPublicApi());
//# sourceMappingURL=index.es6_883fabaf.js.map