!function(){"use strict";var t,e={};function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}t=e,"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0});var i="FIRST_IN_CART",o="OFFER_CART_CAPACITY_EXCEEDED",a="application/vnd.allegro.public.v5+json",s=function(t){return t.code===o},u=function(t){return function(e){return window.opbox.edge.post("/carts/changeQuantityCommand",{items:e},{headers:{Accept:a,"Content-Type":a},withCredentials:!0}).catch((function(e){var r=e.status,n=e.data;if(422===r&&n&&n.errors&&n.errors.find(s))return window.location.assign("/".concat(t,"?error=CART_CAPACITY_EXCEEDED"));throw Error("Failed to add to cart. Status: ".concat(r,". Data: ").concat(JSON.stringify(n),"."))}))}},d="application/vnd.allegro.internal.v6+json",c="application/vnd.allegro.internal.v7+json",l=function(t){return function(e){var r=e.items,n=e.position,a=void 0===n?i:n;return window.opbox.edge.post("/carts/items",{items:r,position:a},{headers:{Accept:c,"Content-Type":c},withCredentials:!0}).then((function(e){var r=e.data,n=o,i=!1;return r.items.filter((function(t){var e;return(null==t||null==(e=t.errors)?void 0:e.length)>0})).forEach((function(t){t.errors.find((function(t){return t.code===n}))&&(i=!0)})),i?window.location.assign("/".concat(t,"?error=CART_CAPACITY_EXCEEDED")):e})).catch((function(t){var e=t.status,r=t.data;if(r.errors&&r.errors.length>0)throw Error("Failed to add to cart. ".concat(r.errors[0].message));throw Error("Failed to add to cart. Status: ".concat(e,". Data: ").concat(JSON.stringify(r),"."))}))}},f=function(t){return window.opbox.edge.delete("".concat("/cart/items","?ids=").concat(t.join(",")),{headers:{Accept:"application/vnd.allegro.internal.v1+json"},withCredentials:!0})},h=function(t){return window.opbox.edge.put("/carts/items/quantity",t,{headers:{Accept:c,"Content-Type":c},withCredentials:!0})},p=function(){return window.opbox.edge.get("/carts",{headers:{Accept:d,"Content-Type":d},withCredentials:!0})},y=Error("Failed to render precart layer"),m={showPrecartLayer:!1},g=function(){function t(e){var r=this,n=e.window,o=e.props;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.quantityChangeListeners=void 0,this.window=void 0,this.props=void 0,this.changeQuantity=void 0,this.addOffersAPI=void 0,this.deleteOffersAPI=void 0,this.modifyItemsAPI=void 0,this.getItemsAPI=void 0,this.changeItems=function(t,e){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:m).showPrecartLayer;return r.changeQuantity(t).then((function(){var i=t.reduce((function(t,e){return t+e.delta}),0),o=t.map((function(t){return t.itemId}));return r.triggerQuantityChangeListeners(i,o),n?r.window.opbox.page.render.fragment({pathname:r.props.precartLayerUrl,additionalQueryParameters:e}).catch((function(){r.window.opbox.reportError(y)})):Promise.resolve()})).catch((function(t){throw r.window.opbox.reportError(t),t}))},this.addItems=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m;return r.addOffersAPI({items:t.map((function(t){var e,r,n,i;return{offerId:t.offerId,bundleId:null==t?void 0:t.bundleId,quantity:t.quantity,navigationCategory:null!=(e=t.category)&&e.id&&null!=(r=t.category)&&r.tree?{id:null==(n=t.category)?void 0:n.id,treeName:null==(i=t.category)?void 0:i.tree}:null}})),position:e}).then((function(e){var i,o=e.data.items.reduce((function(t,e){return t+e.addedQuantity}),0);r.triggerQuantityChangeListeners(o);var a,s=null==(i=t[0])?void 0:i.sellerId,u=t.map((function(t){return t.offerId}))||[];return null!=n&&n.showPrecartLayer&&r.isSellerIdValidForPrecartLayer(s)&&u.length?r.window.opbox.page.render.fragment({pathname:r.props.precartLayerUrl,additionalQueryParameters:Object.assign(Object.assign(Object.assign({precartOfferId:u},s&&{precartSellerId:s}),(null==(a=t[0])?void 0:a.bundleId)&&{rebateId:t[0].bundleId}),{},{itemQuantity:t.map((function(t){var e=t.itemId,r=t.quantity;return"".concat(e,":").concat(r)}))})}).catch((function(){r.window.opbox.reportError(y)})):Promise.resolve()})).catch((function(t){throw r.window.opbox.reportError(t),t}))},this.modifyItems=function(t){return r.modifyItemsAPI(t)},this.deleteItems=function(t){return r.deleteOffersAPI(t)},this.getItems=function(){return r.getItemsAPI()},this.addOffer=function(t,e){return r.addOffers([t],e)},this.addOffers=function(t,e){return r.changeItems(t.map((function(t){var e=t.itemId,r=t.quantity,n=t.sellerId,i=t.category;return{itemId:e,delta:r,sellerId:n,navCategoryId:i&&i.id,navTree:i&&i.tree}})),{precartOfferId:t.map((function(t){return t.itemId})),precartSellerId:t[0].sellerId,itemQuantity:t.map((function(t){var e=t.itemId,r=t.quantity;return"".concat(e,":").concat(r)}))},e)},this.removeOffer=function(t){var e=t.itemId,n=t.quantity,i=t.sellerId,o=t.allowDelete;return r.changeItems([Object.assign({itemId:e,delta:-1*n,sellerId:i},!0===o&&{allowDelete:o})])},this.addBundle=function(t,e){var n=t.bundleMainItemId,i=t.quantity,o=t.sellerId,a=t.rebateId,s=t.itemsIds;return r.changeItems([{itemId:n,delta:i,sellerId:o,rebateId:a}],{precartOfferId:s,precartSellerId:o,rebateId:a,quantity:i.toString(10)},e)},this.triggerQuantityChangeListeners=function(t,e){r.quantityChangeListeners.forEach((function(r){return r(t,e)}))},this.registerQuantityChangeListener=function(t){r.quantityChangeListeners.push(t)},this.unregisterQuantityChangeListener=function(t){r.quantityChangeListeners=r.quantityChangeListeners.filter((function(e){return e!==t}))},this.window=n,this.quantityChangeListeners=[],this.props=o,this.changeQuantity=u(this.getCartPathname()),this.addOffersAPI=l(this.getCartPathname()),this.deleteOffersAPI=f,this.modifyItemsAPI=h,this.getItemsAPI=p}var e,o;return e=t,(o=[{key:"getCartPathname",value:function(){var t,e=(t=this.props.precartLayerUrl.split("/"),function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,o,a,s=[],u=!0,d=!1;try{for(o=(r=r.call(t)).next;!(u=(n=o.call(r)).done)&&(s.push(n.value),2!==s.length);u=!0);}catch(t){d=!0,i=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(d)throw i}}return s}}(t)||function(t,e){if(t){if("string"==typeof t)return r(t,2);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,2):void 0}}(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[1];return void 0===e?"koszyk":e}},{key:"getPublicApi",value:function(){return{addItems:this.addItems,deleteItems:this.deleteItems,modifyItems:this.modifyItems,getItems:this.getItems,addBundle:this.addBundle,addOffer:this.addOffer,addOffers:this.addOffers,removeOffer:this.removeOffer,registerQuantityChangeListener:this.registerQuantityChangeListener,unregisterQuantityChangeListener:this.unregisterQuantityChangeListener}}},{key:"isSellerIdValidForPrecartLayer",value:function(t){return!!t||""===t}}])&&function(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(o=function(t,e){if("object"!==n(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return t+""}(i.key),"symbol"===n(o)?o:o+""),i)}var o}(e.prototype,o),Object.defineProperty(e,"prototype",{writable:!1}),t}(),v=function(t){try{return JSON.parse(window.document.querySelector('script[data-serialize-plugin-name="cart"][data-civ="81d"]').textContent)}catch(t){return window.opbox.reportError(Error('Missing serialized props of plugin "cart", with civ "81d"')),{}}}().cartConfiguration;v&&window.opbox.plugin.register({name:"cart"},new g({window:window,props:v}).getPublicApi());var I=window;for(var w in e)I[w]=e[w];e.__esModule&&Object.defineProperty(I,"__esModule",{value:!0})}();
//# sourceMappingURL=index_dd4f1c8f.js.map