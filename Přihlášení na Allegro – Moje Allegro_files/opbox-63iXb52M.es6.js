Object.freeze({initialize({modulePath:e=".",importFunctionName:t="__import__"}={}){try{self[t]=Function("u","return import(u)")}catch(r){const o=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((r,s)=>{const i=new URL(e,o);if(self[t].moduleMap[i])return r(self[t].moduleMap[i]);const a=new Blob([`import * as m from '${i}';`,`${t}.moduleMap['${i}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(a),onerror(){s(Error("Failed to import: "+e)),n(l)},onload(){r(self[t].moduleMap[i]),n(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}}).initialize({modulePath:"https://assets.allegrostatic.com/sc-12453"});const e="Request has been aborted",t=e=>e>=200&&e<=204,r=(e,t,r,o)=>{const{status:n,response:s,responseType:i}=e,a=t(n),l=(e=>e.split("\n").reduce(((e,t)=>{const r=t.indexOf(":"),o=t.substr(0,r).trim().toLowerCase(),n=t.substr(r+1).trim();return o&&(e[o]=e[o]?`${e[o]}, ${n}`:n),e}),{}))(e.getAllResponseHeaders());let c;if("blob"===i)c=s;else{const{responseText:t}=e;try{c=JSON.parse(t)}catch(d){c=t}}a?r({status:n,data:c,headers:l}):o({status:n,data:c,message:"Request failed with status code "+n,headers:l})};var o=()=>{let o=null;const n=(n,s,i,{headers:a={},validateStatus:l=t,withCredentials:c=!1,cancelLast:d=!1,onUploadProgress:h,responseType:u="",signal:p})=>(d&&(console.log("You are using deprecated option that will be removed in next major version of opbox-web-browser. Consider using signal option instead"),null!==o&&o.abort()),(()=>{let t=0;return new Promise(((d,m)=>{const g=()=>{t+=1,(()=>{if(p&&p.aborted)return Promise.reject(Error(e));const t=((e,t,r,o,n,s)=>{const i=new XMLHttpRequest;return i.open(e,t,!0),Object.keys(r).forEach((e=>{i.setRequestHeader(e,r[e])})),i.withCredentials=o,i.responseType=s,i.upload&&n&&i.upload.addEventListener("progress",n),i})(n,s,a,c,h,u);o=t;const d=((e,t,o)=>new Promise(((n,s)=>{function i(){r(e,t,n,s),c()}function a(){r(e,t,n,s),c()}function l(){e.abort(),s(Error("Request has been aborted")),c()}function c(){e.removeEventListener("load",i),e.removeEventListener("error",a),o&&o.removeEventListener("abort",l)}e.addEventListener("load",i),e.addEventListener("error",a),o&&o.addEventListener("abort",l)})))(t,l,p).finally((()=>{o=null}));return((e,t,r)=>{e.send(((e,t)=>["POST","PUT","PATCH"].includes(e)?"object"!=typeof t||t instanceof Blob||t instanceof FormData?t:JSON.stringify(t):null)(t,r))})(t,n,i),d})().then(d).catch((e=>{if(0===(null==e?void 0:e.status)&&t<5)if(navigator.onLine)setTimeout(g,300*t);else{const e=()=>{window.removeEventListener("online",e),g()};window.addEventListener("online",e)}else m(e)}))};g()}))})());return{request:n,get(e,t={}){return n("GET",e,{},t)},post(e,t,r){return n("POST",e,t,r)},put(e,t,r){return n("PUT",e,t,r)},patch(e,t,r){return n("PATCH",e,t,r)},delete(e,t={}){return n("DELETE",e,{},t)}}};const n="opbox",s=e=>e[n]||{};class i extends Error{constructor(e){super(e),this.message=e,this.name="PageRenderingError"}}const a="metrum-",l="/metrum/",c="data-opbox-fragment-pathname";function d(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e}function h(e){return null===e||"object"!=typeof e||0===Object.keys(e).length}function u(e){return!!("object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName)}function p(e=""){return e.includes(l)}function m(e){return"string"!=typeof e?"":e.split(l)[1].split("/")[0].replace(a,"")}function g(){}function b(e,t,r){let o;return function(...r){return clearTimeout(o),o=setTimeout((()=>{o=null,e.apply(this,r)}),t),o}}function f(e,t,r={}){const o=new CustomEvent(t,Object.assign({bubbles:!1,cancelable:!0},r));e.dispatchEvent(o)}function E(e,t,...r){if(0===r.length)return t;const[o,...n]=r;return(e="object"!=typeof e?{}:e)[o]=E(e[o],t,...n),e}function v(e,t){return Object.keys(e).reduce(((r,o)=>{const n=e[o],s="object"==typeof n?v(n,t):n;return r[t.find((e=>o.toLowerCase()===e.toLowerCase()))||o]=s,r}),{})}function y(e,t=()=>!1){Object.keys(e).forEach((r=>{({}).hasOwnProperty.call(e,r)&&t(r,e[r])&&delete e[r]}))}const C=/Version\/[\d.]+.*Safari/,I=/iPhone|iPad|iPod|Android/i,x=e=>(t,r)=>Object.assign(Object.assign({},t),e(r)),N=()=>Date.now();function w(e){return"noModule"in e.document.createElement("script")}function S(e){setTimeout(e,0)}function P(e,t){"loading"===e.readyState?e.addEventListener("DOMContentLoaded",t):t()}class A{constructor({data:e,headers:t}){this.data=e,this.headers=t}get valid(){return d(this.data)}}class O{constructor(e={}){this.dataSources=e}resolve(e,t){const{value:r}=e;if("DATA_SOURCE"===e.type){const e=this.dataSources[r];return Object.assign(Object.assign({},e&&e.data&&{[t]:e.data}),e&&!h(e.metadata)&&{[t+".$meta"]:e.metadata})}return{[t]:r}}resolveAll(e){return Object.keys(e).reduce(((t,r)=>Object.assign(Object.assign({},t),this.resolve(e[r],r))),{})}}class T{constructor({boxes:e={},dataSources:t={},meta:r={}}={}){this.boxes=e,this.dataSources=t,this.meta=r,this.parameterResolver=new O(t)}get resolved(){return{boxes:this.resolvedBoxes,dataSources:this.dataSources,meta:this.meta}}get resolvedBoxes(){const{pageProperties:e}=this;return Object.fromEntries(Object.keys(this.boxes).map((t=>{const r=this.boxes[t],o=Object.keys(r).reduce(((e,t)=>{const o=this.parameterResolver.resolve(r[t],t);return Object.assign(e,o)}),{});return[t,Object.assign(o,e)]})))}get pageProperties(){const e={};for(const t in this.meta)0===t.indexOf("$page.")&&(e[t]=this.meta[t]);return e}}function k({href:e},t={}){const r=new URL(e);return r.search=((e,t)=>{const r=new URLSearchParams(e.search);return Object.entries(t).map((([e,t])=>(Array.isArray(t)?(r.delete(e),t.forEach((t=>r.append(e,t)))):r.set(e,t),r))),r})(r,t).toString(),r.toString()}function _({targetWindow:e,node:t}){var r;const o=e.location.href,n=null===(r=null==t?void 0:t.closest(`[${c}]`))||void 0===r?void 0:r.getAttribute(c),s=new URL(o);return n&&(s.pathname=n),s.href}const M="owb-000001",L="owb-00010001",B="owb-00010002",D="owb-00010003",R="owb-00010101",V="owb-000301",j="owb-000302",F="owb-000401",W="owb-010001",U={MISSING_CONTEXT:"owb-010101",INVALID_CONTEXT:"owb-010102",MISPLACED_CONTEXT:"owb-010103",MISSING_ACTION:"owb-010104",INVALID_ACTION:"owb-010105",MISSING_BOX_OF_CONTEXT_NODE:"owb-010106"},$={MISSING_CONTEXT:"owb-010201",INVALID_CONTEXT:"owb-010202",MISPLACED_CONTEXT:"owb-010203",MISSING_ACTION:"owb-010204",INVALID_ACTION:"owb-010205",MISSING_BOX_OF_CONTEXT_NODE:"owb-010206"},H={MISSING_CONTEXT:"owb-010301",INVALID_CONTEXT:"owb-010302",MISPLACED_CONTEXT:"owb-010303",MISSING_ACTION:"owb-010304",INVALID_ACTION:"owb-010305",MISSING_BOX_OF_CONTEXT_NODE:"owb-010306"},G={MISSING_CONTEXT:"owb-010401",INVALID_CONTEXT:"owb-010402",MISPLACED_CONTEXT:"owb-010403",MISSING_ACTION:"owb-010404",INVALID_ACTION:"owb-010405",MISSING_BOX_OF_CONTEXT_NODE:"owb-010406"},X={MISSING_CONTEXT:"owb-010501",INVALID_CONTEXT:"owb-010502",MISPLACED_CONTEXT:"owb-010503",MISSING_ACTION:"owb-010504",INVALID_ACTION:"owb-010505",MISSING_BOX_OF_CONTEXT_NODE:"owb-010506"},z={MISSING_CONTEXT:"owb-010601",INVALID_CONTEXT:"owb-010602",MISPLACED_CONTEXT:"owb-010603",MISSING_ACTION:"owb-010604",INVALID_ACTION:"owb-010605",MISSING_BOX_OF_CONTEXT_NODE:"owb-010606"},q="owb-020101",J="owb-020201",Q="owb-020202",K={MISSING_ID:"owb-03000001"},Y={MISSING_PATHNAME:"owb-03000101",INVALID_PATHNAME:"owb-03000102"},Z={MISSING_BOX_ID:"owb-03000201",INVALID_BOX_ID:"owb-03000202",MISSING_BOX_ENTRY:"owb-03000203",MISSING_SLOT_NAME:"owb-03000204",INVALID_SLOT_NAME:"owb-03000205",MISSING_SLOT_WRAPPER:"owb-03000206",INVALID_SLOT_WRAPPER:"owb-03000207",MISPLACED_SLOT_WRAPPER:"owb-03000208",MISSING_SLOT_CHILDREN:"owb-03000209"},ee="owb-040001",te="owb-040002",re="owb-040003",oe="owb-040004",ne="owb-040005",se="owb-040006",ie="owb-040007",ae="owb-040008",le="owb-040009",ce="owb-040010",de="owb-040011",he="owb-050001",ue="owb-050101",pe="owb-050201",me={INVALID_ARG:"owb-050301",UNREGISTERED_CALLBACK_REMOVAL:"owb-050302"},ge={INVALID_ARG:"owb-050401",UNREGISTERED_CALLBACK_REMOVAL:"owb-050402"},be="owb-0601",fe="owb-0701",Ee="owb-080001",ve="owb-080002",ye="owb-080003",Ce="owb-080004",Ie="owb-080005",xe="owb-090001",Ne="owb-090101",we="Property 'contextNode' is required!",Se="Property 'contextNode' should be a valid HTMLElement!",Pe="Property 'contextNode' should be a valid HTMLElement contained inside body!",Ae="Property 'action' is required!",Oe="Property 'action' must be a string!",Te="Could not find box parent of 'contextNode'!",ke={[M]:()=>"Failed to parse page debug data.",[L]:()=>"Lazy scripts: incorrect dependency map JSON",[B]:()=>"Could not find boxEntry by findByNode",[D]:({prototypeId:e,clientImplementationVersion:t})=>`Lazy scripts: Entry not found for "${e}@${t}"`,[R]:({boxName:e,boxId:t,scId:r})=>`There was a problem during deserialization of JSON ${r} ${e} ${t}`,[V]:()=>"Error while writing data to storage",[j]:()=>"Error while loading data from storage",[F]:()=>"Error while deserializing JSON",[W]:()=>"An error occurred while extracting custom parameters from attributes",[U.MISSING_CONTEXT]:()=>we,[U.INVALID_CONTEXT]:()=>Se,[U.MISPLACED_CONTEXT]:()=>Pe,[U.MISSING_ACTION]:()=>Ae,[U.INVALID_ACTION]:()=>Oe,[U.MISSING_BOX_OF_CONTEXT_NODE]:()=>Te,[$.MISSING_CONTEXT]:()=>we,[$.INVALID_CONTEXT]:()=>Se,[$.MISPLACED_CONTEXT]:()=>Pe,[$.MISSING_ACTION]:()=>Ae,[$.INVALID_ACTION]:()=>Oe,[$.MISSING_BOX_OF_CONTEXT_NODE]:()=>Te,[H.MISSING_CONTEXT]:()=>we,[H.INVALID_CONTEXT]:()=>Se,[H.MISPLACED_CONTEXT]:()=>Pe,[H.MISSING_ACTION]:()=>Ae,[H.INVALID_ACTION]:()=>Oe,[H.MISSING_BOX_OF_CONTEXT_NODE]:()=>Te,[G.MISSING_CONTEXT]:()=>we,[G.INVALID_CONTEXT]:()=>Se,[G.MISPLACED_CONTEXT]:()=>Pe,[G.MISSING_ACTION]:()=>Ae,[G.INVALID_ACTION]:()=>Oe,[G.MISSING_BOX_OF_CONTEXT_NODE]:()=>Te,[X.MISSING_CONTEXT]:()=>we,[X.INVALID_CONTEXT]:()=>Se,[X.MISPLACED_CONTEXT]:()=>Pe,[X.MISSING_ACTION]:()=>Ae,[X.INVALID_ACTION]:()=>Oe,[X.MISSING_BOX_OF_CONTEXT_NODE]:()=>Te,"owb-010601":()=>we,"owb-010602":()=>Se,"owb-010603":()=>Pe,"owb-010604":()=>Ae,"owb-010605":()=>Oe,"owb-010606":()=>Te,[q]:({method:e})=>`There was some problem executing "${e}" method on box instance`,[J]:({slotList:e,scId:t,boxName:r,prototypeId:o,clientImplementationVersion:n})=>`box - did not render its slots (${e}) server side, blame "${t}" "${r}" "${o}@${n}"`,[Q]:({scId:e,boxName:t,prototypeId:r,clientImplementationVersion:o})=>`unknown box - did not render its slots server side "${e}" "${t} "${r}@${o}"`,[K.MISSING_ID]:()=>"Missing 'boxId' property!",[Y.MISSING_PATHNAME]:()=>"Missing 'pathname' property!",[Y.INVALID_PATHNAME]:()=>"Invalid 'pathname' property!",[Z.MISSING_BOX_ID]:()=>"Missing 'boxId' property!",[Z.INVALID_BOX_ID]:()=>"'boxId' property must be a string",[Z.MISSING_BOX_ENTRY]:()=>"owb-03000203 Could not find box with given 'boxId'!",[Z.MISSING_SLOT_NAME]:()=>"Missing 'slotName' property!",[Z.INVALID_SLOT_NAME]:()=>"'slotName' property must be an string!",[Z.MISSING_SLOT_WRAPPER]:()=>"Missing 'slotWrapper' property!",[Z.INVALID_SLOT_WRAPPER]:()=>"Property 'slotWrapper' must be a HTMLElement!",[Z.MISPLACED_SLOT_WRAPPER]:()=>"'slotWrapper' property must be Element existing in the document!",[Z.MISSING_SLOT_CHILDREN]:()=>"'slotWrapper' does not contain all current children registered with the slot as first level children",[ee]:()=>'Property "handledPrototype" must have "prototypeName" field',[te]:()=>'Property "prototypeName" cannot be empty string',[re]:({type:e})=>'Property "prototypeName" must be string but got '+e,[oe]:({type:e})=>'Property "clientImplementationVersion" must be string but got '+e,[ne]:()=>"Empty handledPrototypes list",[se]:()=>'"handledPrototype" argument must be an object or an array',[ie]:()=>'"implementation" must be a class',[ae]:({type:e})=>'"onUpdate" property must be a function or undefined but got '+e,[le]:()=>'"implementation" class has to have "onMount" method',[ce]:({prototypeName:e,implementationVersionMessage:t})=>`${e} ${t} already registered!`,[de]:()=>'Property "clientImplementationVersion" is missing',[he]:()=>"New parameters (array) or hash (string) required",[ue]:({type:e})=>"First argument must be a function but got "+e,[pe]:({type:e})=>"First argument must be a function but got "+e,[me.INVALID_ARG]:({type:e})=>"First argument must be a function but got "+e,[me.UNREGISTERED_CALLBACK_REMOVAL]:()=>"Trying to remove unregistered callback",[ge.INVALID_ARG]:({type:e})=>"First argument must be a function but got "+e,[ge.UNREGISTERED_CALLBACK_REMOVAL]:()=>"Trying to remove unregistered callback",[be]:()=>"Error while fetching page data",[fe]:()=>"Error while fetching page data",[Ee]:()=>'Plugin registration error. First argument "config" should be defined',[ve]:()=>'Plugin registration error. Property "name" should be a string',[ye]:()=>'Plugin registration error. Property "name" should be a non-empty string',[Ce]:()=>'Plugin registration error. Second argument "implementation" is required',[Ie]:({name:e})=>`Plugin registration error. Plugin "${e}" is not allowed to register on this page`,[xe]:()=>"Error while trying to inject service scripts",[Ne]:()=>"Error while trying to register service implementation"},_e="application/vnd.opbox-web.subtree+json";function Me(e){return e>=200&&e<300||502===e}class Le{constructor({targetWindow:e=window,config:t,httpClient:r,reportError:o,fragmentRenderCallback:n,boxRenderCallback:s,slotRenderCallback:i,componentNodesFinder:a}){this.updateViewId=e=>{this.viewId=e},this.httpClient=r,this.reportError=o,this.targetWindow=e,this.fragmentRenderCallback=n,this.boxRenderCallback=s,this.slotRenderCallback=i,this.render={box:this.renderBox.bind(this),fragment:this.renderFragment.bind(this),slot:this.renderSlot.bind(this)},this.viewId=t.viewId,this.pageRenderingStatus=t.pageRenderingStatus,this.getPageDataAbortController=new AbortController,this.componentNodesFinder=a}getPageData(e){this.getPageDataAbortController.abort(),this.getPageDataAbortController=new AbortController;const t={headers:{Accept:"application/vnd.opbox-web.v2+json"},validateStatus:Me,signal:this.getPageDataAbortController.signal};return this.httpClient.get(e,t).then((e=>{const t=new A(e);if(!t.valid)throw new i("Opbox response is invalid.");return new T(t.data)}))}handleError(e,t={}){return this.reportError(e,{errorContext:t}),Promise.reject(e)}renderBox({boxId:e,additionalQueryParameters:t={},isPlaceholder:r=!1}={}){if(!e)return this.handleError(K.MISSING_ID);const o=this.componentNodesFinder.findByBoxId(e,r),n=_({targetWindow:this.targetWindow,node:null==o?void 0:o.node});return this.httpClient.get(k({href:n},t),{headers:{Accept:_e,"x-box-id":e,"x-view-id":this.viewId,"x-page-rendering-status":this.pageRenderingStatus},validateStatus:Me}).then((({data:t})=>this.boxRenderCallback({boxId:e,data:t,isPlaceholder:r})))}renderFragment({pathname:e,additionalQueryParameters:t={}}={}){if(!e)return this.handleError(Y.MISSING_PATHNAME);if(!(e=>!!e.match(RegExp("^(\\/[a-zA-Z0-9\\-]+)*\\/{0,1}$")))(e))return this.handleError(Y.INVALID_PATHNAME);const{protocol:r,host:o}=this.targetWindow.location,{href:n}=new URL(`${r}//${o}${e}`);return this.httpClient.get(k({href:n},t),{headers:{Accept:_e,"x-view-id":this.viewId},validateStatus:Me}).then((({data:t})=>this.fragmentRenderCallback({pathname:e,data:t})))}renderSlot({boxId:e,slotName:t,slotWrapper:r,additionalQueryParameters:o={}}={}){if(!e)return this.handleError(Z.MISSING_BOX_ID);if("string"!=typeof e)return this.handleError(Z.INVALID_BOX_ID);const n=this.componentNodesFinder.findByBoxId(e);if(!(null==n?void 0:n.boxEntry))return this.handleError(Z.MISSING_BOX_ENTRY);const s={tags:{scId:n.boxEntry.scId}};if(!t)return this.handleError(Z.MISSING_SLOT_NAME,s);if("string"!=typeof t)return this.handleError(Z.INVALID_SLOT_NAME,s);if(!r)return this.handleError(Z.MISSING_SLOT_WRAPPER,s);if(!u(r))return this.handleError(Z.INVALID_SLOT_WRAPPER,s);if(!this.targetWindow.document.contains(r))return this.handleError(Z.MISPLACED_SLOT_WRAPPER,s);const i=this.componentNodesFinder.findSlotBoxes(e,t),a=new Set(r.childNodes.values());if(i.some((e=>!a.has(e.node))))return this.handleError(Z.MISSING_SLOT_CHILDREN,s);const l=_({targetWindow:this.targetWindow,node:n.node});return this.httpClient.get(k({href:l},o),{headers:{Accept:_e,"x-box-id":e,"x-slot-name":t,"x-view-id":this.viewId,"x-page-rendering-status":this.pageRenderingStatus},validateStatus:Me}).then((({data:o})=>this.slotRenderCallback({data:o,boxId:e,slotName:t,slotWrapper:r})))}createAPI(){return{render:this.render}}}function Be(e){return e&&e.__esModule&&{}.hasOwnProperty.call(e,"default")?e.default:e}var De,Re={exports:{}},Ve=Be((De||(De=1,Re.exports=(()=>{function e(e){return e instanceof Object&&e.constructor===Object}function t(r,o){var n=r,s=o;e(r)||(n={}),e(o)||(s={});var i=Object.keys(n),a=Object.keys(s),l={};return i.forEach((r=>{-1!==a.indexOf(r)?null===n[r]?l[r]=s[r]:e(n[r])&&e(s[r])?l[r]=t(n[r],s[r]):l[r]=s[r]:l[r]=n[r]})),a.forEach((e=>{-1===i.indexOf(e)&&(l[e]=s[e])})),l}return function(r){var o=r;e(r)||(o={});for(var n=arguments.length,s=Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return s.forEach((r=>{e(r)&&(o=t(o,r))})),o}})()),Re.exports));const je=new WeakMap,Fe=new WeakMap,We=new WeakMap,Ue=e=>Fe.has(e),$e=(e,t,r=0)=>{if(!e||Ue(e))return;const o=(parseInt(We.get(e),10)||0)+t;o>=r&&(Fe.set(e,!0),f(e,"boxView",{bubbles:!0})),We.set(e,o)},He=(e,t,r,o)=>{const n={lowerValue:e,higherValue:t,viewportDimension:r,overrideLength:o};return je.has(n)||je.set(n,e>0?e<r?t<r?t-e:r-e:0:t<0?0:t<r?t:e<=0&&t>=r?r:o),je.get(n)},Ge="data-box-name",Xe="data-analytics-category",ze="data-analytics-tags",qe="data-item",Je="light",Qe=e=>e.replace(/^([A-Z])|[\s|_-](\w)/g,((e,t,r)=>r?r.toUpperCase():t.toLowerCase())),Ke=({contextNode:e,stringParamCustomPrefix:t,jsonParamCustomPrefix:r,componentNodesFinder:o,reportError:n=()=>{}})=>{const s={};for(let a=0;a<e.attributes.length;a+=1){const l=e.attributes[a];if(t&&l.name.startsWith(t)){const e=l.name.replace(t,"");s[Qe(e)]=l.value}if(r&&l.name.startsWith(r)){const t=l.name.replace(r,"");try{s[Qe(t)]=JSON.parse(l.value)}catch(i){const r=o.getBlameTags(e);n(W,{error:i,errorContext:{attributeName:l.name,customParamName:t,tags:r.tags}})}}}return s},Ye=(e,t,r,o)=>{const n=o||t.viewId;return Ve(r||t.cookieMonster.defaultCustomParams.pv,rt(e,t),n?{_opbox:{viewId:n}}:void 0)},Ze=({contextNode:e,customParams:t={},reportError:r,componentNodesFinder:o})=>{const n=Ke({contextNode:e,stringParamCustomPrefix:"data-analytics-view-opbox-custom-",componentNodesFinder:o,reportError:r}),s=Object.keys(n).length?{_opbox:n}:{};return Ve(Ke({contextNode:e,stringParamCustomPrefix:"data-analytics-view-custom-",jsonParamCustomPrefix:"data-analytics-view-json-custom-",componentNodesFinder:o,reportError:r}),s,t)},et=({contextNode:e,coordinates:t={},destinationUrl:r="",customParams:o={},isNewTab:n,reportError:s,componentNodesFinder:i})=>{const a=n?{isNewTab:n}:{},l=Object.assign(Object.assign(Object.assign(Object.assign({},Ke({contextNode:e,stringParamCustomPrefix:"data-analytics-click-opbox-custom-",componentNodesFinder:i,reportError:s})),{destinationUrl:r}),a),t);return Ve(Ke({contextNode:e,stringParamCustomPrefix:"data-analytics-click-custom-",jsonParamCustomPrefix:"data-analytics-click-json-custom-",componentNodesFinder:i,reportError:s}),{_opbox:l},o)},tt=({contextNode:e,customParams:t={},reportError:r,componentNodesFinder:o})=>{const n=Ke({contextNode:e,stringParamCustomPrefix:"data-analytics-interaction-custom-",jsonParamCustomPrefix:"data-analytics-interaction-json-custom-",componentNodesFinder:o,reportError:r}),s=Ke({contextNode:e,stringParamCustomPrefix:"data-analytics-interaction-opbox-custom-",componentNodesFinder:o,reportError:r}),i=Object.keys(s).length?{_opbox:s}:{};return Ve(n,i,t)},rt=(e,t)=>{const r=e.matchMedia("(prefers-color-scheme: dark)").matches?"dark":Je;return{systemColorScheme:r,userSelectedColorScheme:t.colorScheme,renderedColorScheme:t.isDarkModeEnabled?r:Je,defaultColorScheme:Je}},ot=2e3;class nt{constructor({targetWindow:e,config:t,cookieMonsterClient:r,boxViewsMarker:o,reportError:n,componentNodesFinder:s}){this.sendPingEvent=({engagementTime:e,scrollBottom:t,pageHeight:r})=>{const o={category:"Engagement",label:"ping",customParams:{et:e,sb:t,ph:r}};this.cookieMonsterClient.send("event",o),this.callEventCallbacks(o)},this.detectAdblock=()=>{const{document:e}=this,t=Object.assign(e.createElement("div"),{innerHTML:"&nbsp;",className:"adsbox"});e.body.appendChild(t),this.targetWindow.setTimeout((()=>{const r=0!==t.offsetHeight;this.cookieMonsterClient.send("event",{category:"clearPV",action:r,customParams:this.defaultCustomParams.ev}),e.body.removeChild(t)}),100)},this.handleClick=e=>{this.handleBoxInteraction(e),this.handleLinkClick(e)},this.handleLinkClick=e=>{if("function"!=typeof e.target.closest)return;if(this.shouldHandleBoxInteraction(e))return void this.handleBoxInteraction(e);const t=e.target.closest("a");if(!t||!t.hasAttribute("data-analytics-clickable"))return;const r=t.getAttribute("data-analytics-click-label")||"",o=t.getAttribute("data-analytics-click-value")||(t.textContent||"").trim(),n="_blank"===t.getAttribute("target"),s=t.getAttribute("href")||"",i=e.pageX?{pageX:e.pageX,pageY:e.pageY}:{};"click"!==e.type||0!==e.button?"contextmenu"!==e.type?"mousedown"===e.type&&1===e.button&&this.sendClickEvent({contextNode:t,label:r,value:o,customParams:et({contextNode:t,coordinates:i,destinationUrl:s,isNewTab:!0,reportError:this.reportError,componentNodesFinder:this.componentNodesFinder})}):this.sendContextmenuEvent({contextNode:t,label:r,value:o,customParams:et({contextNode:t,coordinates:i,destinationUrl:s,reportError:this.reportError,componentNodesFinder:this.componentNodesFinder})}):this.sendClickEvent({contextNode:t,label:r,value:o,customParams:et({contextNode:t,coordinates:i,destinationUrl:s,isNewTab:n||e.metaKey||e.ctrlKey,reportError:this.reportError,componentNodesFinder:this.componentNodesFinder})})},this.handleChange=e=>{const t=e.target;if("select-one"===t.type&&t&&t.hasAttribute("data-analytics-selectable")){const{value:e}=t.options[t.selectedIndex],r=Ke({contextNode:t,stringParamCustomPrefix:"data-analytics-select-custom-",componentNodesFinder:this.componentNodesFinder,reportError:this.reportError});this.sendEvent({contextNode:t,action:"change",value:e,customParams:r})}},this.handleSubmit=e=>{const t=e.target;if(!t||"FORM"!==t.nodeName||!t.hasAttribute("data-analytics-submittable"))return;const r=t.getAttribute("action")||"";let o=Array.from(t.elements).filter((e=>!!e.name)).map((e=>({name:e.name,value:e.value}))).sort(((e,t)=>e.name.toLowerCase().localeCompare(t.name.toLowerCase()))).map((e=>`${e.name}=${e.value}`)).join("&");o=o?"?"+o:"";let n=o?r+o:r;n=encodeURI(n),this.sendFormSubmitEvent({contextNode:t,value:n,label:"submitForm"})},this.handleBoxView=e=>{var t,r;const o=e.target;if(!o)return;const n=this.componentNodesFinder.findByNode(o);if(!(null===(r=null===(t=null==n?void 0:n.boxEntry)||void 0===t?void 0:t.analytics)||void 0===r?void 0:r.enabled)&&!o.hasAttribute("data-analytics-enabled")||Array.from(o.childNodes).filter((e=>!!e.classList)).some((e=>e.classList.contains("opbox-fragment"))))return;const s=o.getAttribute("data-analytics-view-value")||"",i=o.getAttribute("data-analytics-view-label")||"";let a=Ze({contextNode:o,reportError:this.reportError,componentNodesFinder:this.componentNodesFinder});if(o.firstChild&&o.firstChild.nodeType===Node.ELEMENT_NODE&&(a=Object.assign(Object.assign({},a),Ke({contextNode:o.firstChild,stringParamCustomPrefix:"data-analytics-view-custom-",componentNodesFinder:this.componentNodesFinder}))),o.hasAttribute(qe))return this.markParentBoxAsVisible(o),void this.sendItemViewEvent({contextNode:o,label:i,value:s,customParams:a});a=Object.assign(Object.assign({},a),(e=>{if(!e)return{};const t=e.getAttribute("data-analytics-box-view-custom-params");if(!t)return{};let r={};try{r=JSON.parse(decodeURIComponent(t))}catch(o){console.log(o)}return r})(o)),this.sendBoxViewEvent({contextNode:o,value:s,customParams:a})},this.setFragmentAnalyticsContext=(e,t)=>{this.fragmentCustomParams.set(e,t)},this.deleteFragmentAnalyticsContext=e=>{this.fragmentCustomParams.delete(e)};const{cookieMonster:{account:i,isEngagementMeasuringEnabled:a,defaultCustomParams:l={}}={},viewId:c}=t;this.targetWindow=e,this.document=e.document,this.account=i,this.isEngagementMeasuringEnabled=a,this.cookieMonsterClient=r,this.boxViewsMarker=o,this.reportError=n,this.defaultCustomParams=l,this.fragmentCustomParams=new WeakMap,this.config=t,this.viewId=c,this.eventCallbacks=[],this.componentNodesFinder=s;const d=(e=>{var t;return(null===(t=null==e?void 0:e.navigator)||void 0===t?void 0:t.userAgent)||""})(e);this.isMobile=(e=>!!e.match(I))(d),this.isSafari=(e=>!!e.match(C))(d),this.isFirefox=(e=>e.toLowerCase().includes("firefox"))(d)}initialize(){if(!this.account)return;this.cookieMonsterClient.initialize(),this.isEngagementMeasuringEnabled&&(({targetWindow:e,onCycleComplete:t})=>{const r=Date.now,o=r(),n=()=>{const{innerHeight:t,scrollY:r}=e;return t+(r||e.document.documentElement.scrollTop)};let s,i=0,a=0,l=n(),c=0,d=!1;const h=e=>{if(!c)return;let t;t=c<i?Math.min(e-i,ot-(i-c)):Math.min(e-c,ot),a+=t},u=()=>{const{body:t,documentElement:r}=e.document;return r.scrollHeight||t.scrollHeight},p=()=>r()-o,m=()=>{d=!1;const e=p();h(e),(()=>{const e=n();e>l&&(l=e)})(),c=e},g=()=>{var e;e=p(),h(e),a>0&&t({engagementTime:Math.min(a,6e3),scrollBottom:l,pageHeight:u()}),c<e-ot&&(c=0),a=0,i=e,l=n()},{document:b}=e;b.addEventListener("click",m),b.addEventListener("mousemove",m),b.addEventListener("keydown",m),b.addEventListener("scroll",(()=>{d||(d=!0,e.requestAnimationFrame(m))})),e.addEventListener("pagehide",(()=>{e.clearInterval(s),g()})),e.addEventListener("pageshow",(()=>{i=p(),s=e.setInterval(g,6e3)}))})({targetWindow:this.targetWindow,onCycleComplete:this.sendPingEvent});const{document:e}=this;e.addEventListener("change",this.handleChange),e.addEventListener("click",this.handleClick,{capture:!0}),e.addEventListener("mousedown",this.handleLinkClick),e.addEventListener("submit",this.handleSubmit),e.addEventListener("contextmenu",this.handleClick),e.addEventListener("boxView",this.handleBoxView),this.targetWindow.addEventListener("DOMContentLoaded",this.detectAdblock)}callEventCallbacks(e){this.eventCallbacks.length&&this.eventCallbacks.forEach((t=>t(e)))}sendEvent({contextNode:e,action:t,label:r="",value:o,customParams:n={}}={},s=z){let i={action:t,label:r,value:o,customParams:JSON.stringify(n)};if(!e)return this.reportError(s.MISSING_CONTEXT,{errorContext:i});if(!u(e))return this.reportError(s.INVALID_CONTEXT,{errorContext:i});if(!this.targetWindow.document.body.contains(e))return this.reportError(s.MISPLACED_CONTEXT,{errorContext:i});const a=this.componentNodesFinder.findClosestAncestor(e);if(!a)return this.reportError(s.MISSING_BOX_OF_CONTEXT_NODE,{errorContext:i});const{boxEntry:l,node:d}=a;if(l.scId&&(i=Object.assign(Object.assign({},i),{tags:{scId:l.scId}})),!t)return this.reportError(s.MISSING_ACTION,{errorContext:i});if("string"!=typeof t)return this.reportError(s.INVALID_ACTION,{errorContext:i});const{boxName:h,boxId:p,analytics:m}=l,{groups:g=[],tags:b=[],category:f}=m,E=(()=>{const t=e.closest("[data-analytics-category]");return!t||f&&!d.contains(t)?f:t.getAttribute("data-analytics-category")})(),v=e.closest(`[${c}]`),y=Array.from(new Set((e=>{const t=e.closest(`[${ze}]`);return t?((e,t)=>{const r=e.split(","),o=t.split(","),n=r.concat(o);return n.filter(((e,t)=>e&&n.indexOf(e)===t))})(t.closest(`[${qe}]`)?(e=>{const t=e&&e.closest(`[${Ge}][${ze}]`);return t&&t.getAttribute(ze)||""})(t):"",t.getAttribute(ze)||""):[]})(e).concat(b))),C=y.length?{analyticsTags:y}:{},I=g.length?{groups:g}:{},x=p?{boxName:h,boxId:p}:{boxName:h},N=Object.assign(Object.assign(Object.assign({},C),I),x),w={category:E||"",action:t,label:r,value:o,customParams:Ve(Object.assign({},n),{_opbox:N},this.defaultCustomParams.ev,this.getFragmentAnalyticsContext(v))};return this.cookieMonsterClient.send("event",w),this.callEventCallbacks(w),w}sendClickEvent(e){this.sendEvent(Object.assign(Object.assign({},e),{action:"click"}),U)}sendContextmenuEvent(e){this.sendEvent(Object.assign(Object.assign({},e),{action:"contextmenu"}),$)}sendBoxInteractionEvent(e){this.sendEvent(Object.assign(Object.assign({},e),{action:"boxInteraction"}),X)}sendItemViewEvent(e){this.sendEvent(Object.assign(Object.assign({},e),{action:"itemView"}),G)}sendBoxViewEvent(e){this.sendEvent(Object.assign(Object.assign({},e),{action:"boxView"}))}sendFormSubmitEvent(e){this.sendEvent(Object.assign(Object.assign({},e),{action:"submit"}))}handleBoxInteraction(e){if("function"!=typeof e.target.closest)return;const t=e.target.closest("[data-analytics-interaction]");if(!t)return;const r=tt({contextNode:t,reportError:this.reportError,componentNodesFinder:this.componentNodesFinder}),o=t.getAttribute("data-analytics-interaction-label")||"",n=t.getAttribute("data-analytics-interaction-value")||(t.textContent||"").trim();this.sendBoxInteractionEvent({contextNode:t,label:o,value:n,customParams:r})}shouldHandleBoxInteraction(e){return"mousedown"===e.type&&!this.isMobile&&(this.isSafari||this.isFirefox)&&"select-one"===e.target.type}markParentBoxAsVisible(e){var t;const r=e.parentNode&&(null===(t=e.parentNode)||void 0===t?void 0:t.closest("[data-analytics-enabled]"));this.boxViewsMarker&&r&&!Ue(r)&&this.boxViewsMarker.markBoxAsVisible(r,!0)}sendPageViewProxy(){this.account&&(this.cookieMonsterClient.sendPageView(Ye(this.targetWindow,this.config,this.defaultCustomParams.pv,this.viewId)),this.cookieMonsterClient.updateReferrer())}sendEventProxy(e,t,r,o,n){return this.account?e.nodeType===Node.ELEMENT_NODE?this.sendEvent({value:r,label:n,action:t,contextNode:e,customParams:o},H):this.sendEvent(e):null}sendItemViewEventProxy({contextNode:e,label:t,value:r,customParams:o}){this.account&&this.sendItemViewEvent({contextNode:e,label:t,value:r,customParams:Ze({contextNode:e,customParams:o,reportError:this.reportError,componentNodesFinder:this.componentNodesFinder})})}sendClickEventProxy({contextNode:e,label:t,value:r,customParams:o,destinationUrl:n,isNewTab:s}){if(this.account){if(s&&"boolean"!=typeof s)throw Error("isNewTab property must be boolean");this.sendClickEvent({contextNode:e,label:t,value:r,customParams:et({contextNode:e,destinationUrl:n,customParams:o,isNewTab:s,reportError:this.reportError,componentNodesFinder:this.componentNodesFinder})})}}sendContextmenuEventProxy({contextNode:e,label:t,value:r,customParams:o,destinationUrl:n}){this.account&&this.sendContextmenuEvent({contextNode:e,label:t,value:r,customParams:et({contextNode:e,destinationUrl:n,customParams:o,reportError:this.reportError,componentNodesFinder:this.componentNodesFinder})})}sendBoxInteractionEventProxy({contextNode:e,label:t,value:r,customParams:o}){this.account&&this.sendBoxInteractionEvent({contextNode:e,label:t,value:r,customParams:tt({contextNode:e,customParams:o,reportError:this.reportError,componentNodesFinder:this.componentNodesFinder})})}updateCustomParams({pv:e={},ev:t={}}={},r){this.viewId=r,d(e)&&d(t)?this.defaultCustomParams={pv:e,ev:t}:console.log("Can not update custom params with non-object arguments!")}registerEventCallback(e){this.account&&e&&!this.eventCallbacks.includes(e)&&this.eventCallbacks.push(e)}getFragmentAnalyticsContext(e){return this.fragmentCustomParams.get(e)||{}}createAPI(){return{sendPageView:this.sendPageViewProxy.bind(this),sendEvent:this.sendEventProxy.bind(this),sendItemViewEvent:this.sendItemViewEventProxy.bind(this),sendClickEvent:this.sendClickEventProxy.bind(this),sendContextmenuEvent:this.sendContextmenuEventProxy.bind(this),sendBoxInteractionEvent:this.sendBoxInteractionEventProxy.bind(this),registerEventCallback:this.registerEventCallback.bind(this)}}}function st(e,t){var r={};for(var o in e)({}).hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&{}.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]])}return r}"function"==typeof SuppressedError&&SuppressedError;const it=()=>Promise.reject(Error("missing edge host")),at="application/vnd.allegro.public.v1+json";class lt{constructor({httpClient:e,edgeHost:t,config:{language:r,otelTrace:o}}){this.get=(e,t)=>this.httpClient.get(this.prepareRequestUrl(e),this.prepareRequestSettings(t,!0)),this.put=(e,t,r)=>this.httpClient.put(this.prepareRequestUrl(e),t,this.prepareRequestSettings(r)),this.post=(e,t,r)=>this.httpClient.post(this.prepareRequestUrl(e),t,this.prepareRequestSettings(r)),this.patch=(e,t,r)=>this.httpClient.patch(this.prepareRequestUrl(e),t,this.prepareRequestSettings(r)),this.delete=(e,t)=>this.httpClient.delete(this.prepareRequestUrl(e),this.prepareRequestSettings(t,!0)),this.edgeHost=t,this.httpClient=e,this.otelTrace=o,this.defaultHeaders={"Content-Type":at,Accept:at,"Accept-Language":r}}prepareRequestSettings(e={},t=!1){if(e.disableDefaultHeaders)return e;const r=this.normalizeSettings(e),o=this.defaultHeaders,{"Content-Type":n}=o,s=st(o,["Content-Type"]),i=this.otelTrace?{traceparent:`00-${this.otelTrace.traceId}-${[...crypto.getRandomValues(new Uint8Array(8))].map((e=>e.toString(16).padStart(2,"0"))).join("")}-${this.otelTrace.traceFlags}`}:{};return Ve({},t?{headers:s}:{headers:this.defaultHeaders},{headers:i},r)}normalizeSettings(e){if(!e||!e.headers)return e;const t=v(e.headers,Object.keys(this.defaultHeaders));return Object.assign(e,{headers:t})}prepareRequestUrl(e){return this.edgeHost+e}createAPI(){return this.edgeHost?{get:this.get,put:this.put,post:this.post,patch:this.patch,delete:this.delete}:{get:it,put:it,post:it,patch:it,delete:it}}}const ct=["_meta_cross_domain_id","_fbc","_fbp","_meta_facebookTag_sync","_meta_tiktok_ttclid","_ttp","_meta_googleGtag_ga","_meta_googleGtag_gcl_aw","_meta_googleGtag_session_id","_meta_ringierAxelSpringerPoland_adp_session","_meta_ringierAxelSpringerPoland_dlapi_aid","_meta_ringierAxelSpringerPoland_dlapi_lu","_meta_rtbHouse_fired"],dt="cm";class ht{constructor({targetWindow:e,config:t}){this.targetWindow=e,this.config=t}load(e){if(this.cm)return;this.targetWindow["cm.analytics.object"]=dt;const t=this.targetWindow[dt],r=this;this.cm=(...e)=>{var t;((t=r.cm).q||(t.q=[])).push(Array.from(e))},Object.defineProperty(this.targetWindow,dt,{configurable:!0,set(e){r.cm=e,Object.defineProperty(r.targetWindow,dt,{writable:!0,configurable:!0,enumerable:!0,value:e})},get(){return r.cm}}),this.attachTrackerJsScript(),e(),Array.isArray(null==t?void 0:t.q)&&t.q.filter((e=>Array.isArray(e)&&e.length>0)).forEach((([e,...t])=>this.callCM(e,...t)))}attachTrackerJsScript(){{const e=this.targetWindow.document.createElement("script");e.src=this.config.cookieMonster.host,this.targetWindow.document.head.appendChild(e)}}callCM(e,...t){this.cm&&this.cm.call(null,e,...t)}send(...e){const t="send@"+this.config.cookieMonster.account;this.callCM(t,...Array.from(e))}sendPageView(e){const t=null!=e?e:Ye(this.targetWindow,this.config);this.send("pageview",{customParams:t,referrer:this.referrer,customCookies:ct})}updateReferrer(){this.referrer=window.location.href}initialize(){const{account:e,host:t,encodedUserId:r}=this.config.cookieMonster;t&&e&&!this.cm?(this.load((()=>{this.callCM("create",e,{userId:r}),this.sendPageView()})),this.updateReferrer()):this.updateReferrer()}}const ut="data-analytics-enabled",pt="data-analytics-proxied";class mt{constructor({targetWindow:e,boxes:t=[],significantElementSizePercentage:r=.75,significantElementSizeForBiggerThanViewportPercentage:o=.5,timeoutValue:n=500,debounceTimeoutValue:s=20,componentNodesFinder:i}){this.markCurrentlyVisibleElementsAsSeen=()=>{const{timeoutValue:e}=this.config;this.visibleElements.forEach((t=>{$e(t,e,e)}))},this.markPreviouslyVisibleElementAsHidden=e=>{this.visibleElementsByIntersectionObserver.has(e)&&(this.visibleElementsByIntersectionObserver.delete(e),f(e,"outOfViewport"))},this.intersectionHandler=e=>{e.forEach((({target:e,boundingClientRect:t,rootBounds:r})=>{r&&((e,t,r,o)=>{const n=e.right-e.left,s=e.bottom-e.top,i=t.height,a=t.width,l=((e,t)=>(e.top>=t.top&&e.top<=t.bottom||e.bottom<=t.bottom&&e.bottom>=t.top||e.top<t.top&&e.bottom>t.bottom)&&(e.left>=t.left&&e.left<=t.right||e.right<=t.right&&e.right>=t.left||e.left<t.left&&e.right>t.right))(e,t),c=l?He(e.left,e.right,t.width,n):0,d=l?He(e.top,e.bottom,t.height,s):0;return s>i&&d>i*o||n>a&&c>a*o||d*c/(n*s)>r})(t,r,this.config.significantElementSizePercentage,this.config.significantElementSizeForBiggerThanViewportPercentage)?this.visibleElementsByIntersectionObserver.has(e)||(this.visibleElementsByIntersectionObserver.add(e),this.notVisibleElements.delete(e),f(e,"inViewport")):(this.markPreviouslyVisibleElementAsHidden(e),this.notVisibleElements.add(e))})),this.resetCurrentlyVisibleElementsOnTimeout()},this.scrollHandler=()=>{this.state.isScrolling||(this.state.scrollStartTime=(new Date).getTime(),this.state.isScrolling=!0),clearTimeout(this.markCurrentlyVisibleElementsAsSeenOnTimeout()),this.scrollEndHandler()},this.addBox=e=>{null!==e&&-1===this.boxes.indexOf(e)&&(this.boxes.push(e),this.observer.observe(e))},this.isBoxInViewport=e=>this.visibleElementsByIntersectionObserver.has(e),this.markBoxAsRendered=e=>{var t,r,o;return!e.hasAttribute(ut)&&!(null===(o=null===(r=null===(t=this.componentNodesFinder.findByNode(e))||void 0===t?void 0:t.boxEntry)||void 0===r?void 0:r.analytics)||void 0===o?void 0:o.enabled)||e.closest(`[${pt}]`)||this.addBox(e),this.getBoxViewEnabledNodes(e).filter((t=>t!==e)).forEach(this.addBox),Promise.resolve()},this.markBoxAsVisible=(e,t=!1)=>{if(this.addBox(e),t){const{timeoutValue:t}=this.config;$e(e,t,t)}},this.recursivelyMarkBoxAsVisible=(e,t=!1)=>{this.getBoxViewEnabledNodes(e).forEach((e=>this.markBoxAsVisible(e,t)))},this.removeBox=(e,t)=>{null!==e&&(this.markPreviouslyVisibleElementAsHidden(e),((e,t=!0)=>{t&&Fe.delete(e),We.delete(e)})(e,t),this.boxes=this.boxes.filter((t=>t!==e)),this.visibleElements=this.visibleElements.filter((t=>t!==e)),this.observer.unobserve(e))},this.markBoxAsHidden=e=>{this.removeBox(e,!1),this.resetCurrentlyVisibleElementsOnTimeout()},this.unmountNode=e=>{this.getAllBoxViewEnabledNodes(e).forEach((e=>this.removeBox(e,!0)))},this.recursivelyMarkBoxAsHidden=e=>{this.getBoxViewEnabledNodes(e).forEach(this.markBoxAsHidden)},this.trackBoxScroll=e=>{e.addEventListener("scroll",this.scrollHandler)},this.componentNodesFinder=i,this.targetWindow=e,this.document=e.document,this.config={timeoutValue:n,debounceTimeoutValue:s,significantElementSizePercentage:r,significantElementSizeForBiggerThanViewportPercentage:o},this.resetState(),this.boxes=t.length?t:this.getBoxViewEnabledNodes(e.document),this.visibleElements=[],this.visibleElementsByIntersectionObserver=new Set,this.notVisibleElements=new Set,this.observer=new e.IntersectionObserver(this.intersectionHandler,{threshold:[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1]}),this.scrollEndHandler=b(this.resetCurrentlyVisibleElementsAfterScroll,s),this.resetCurrentlyVisibleElementsOnTimeout=function(e,t){let r;return function(...o){return new Promise((n=>{clearTimeout(r),r=setTimeout((()=>{r=null,n(e.apply(this,o))}),t)}))}}(this.resetCurrentlyVisibleElements.bind(this),s),this.markCurrentlyVisibleElementsAsSeenOnTimeout=b(this.markCurrentlyVisibleElementsAsSeen,n)}resetState(){const e=Date.now();this.state={isScrolling:!1,scrollStartTime:e,counterStartTime:e}}getAllBoxViewEnabledNodes(e){var t;const r=Array.from(e.querySelectorAll(`[${ut}]`)),o=this.componentNodesFinder.findSubtree(e).map((e=>e.node)),n=new Set(r.concat(...o));return void 0!==(null===(t=e.dataset)||void 0===t?void 0:t.analyticsEnabled)&&n.add(e),Array.from(n)}getBoxViewEnabledNodes(e){const t=Array.from(e.querySelectorAll(`[${pt}]`)).reduce(((e,t)=>{const r=this.getAllBoxViewEnabledNodes(t).filter((t=>!e.includes(t)));return r.length?e.concat(r):e}),[]);return this.getAllBoxViewEnabledNodes(e).filter((e=>!t.includes(e)))}markPreviouslyVisibleElementsAsSeen(){const e=Date.now();this.visibleElements.forEach((t=>{$e(t,e-this.state.counterStartTime,this.config.timeoutValue)}))}markPreviouslyVisibleElementsAsSeenAfterScroll(){this.visibleElements.forEach((e=>{$e(e,this.state.scrollStartTime-this.state.counterStartTime,this.config.timeoutValue)}))}resetCurrentlyVisibleElements(){this.markPreviouslyVisibleElementsAsSeen(),this.visibleElements=[],this.visibleElementsByIntersectionObserver.forEach((e=>this.visibleElements.push(e))),this.markCurrentlyVisibleElementsAsSeenOnTimeout(),this.resetState()}resetCurrentlyVisibleElementsAfterScroll(){this.markPreviouslyVisibleElementsAsSeenAfterScroll(),this.notVisibleElements.forEach((e=>{this.observer.unobserve(e),this.observer.observe(e)})),this.markCurrentlyVisibleElementsAsSeenOnTimeout(),this.resetState()}initialize(){this.targetWindow.addEventListener("scroll",this.scrollHandler),this.boxes.forEach((e=>this.observer.observe(e)))}createAPI(){return{markBoxAsRendered:this.markBoxAsRendered,markBoxAsVisible:this.markBoxAsVisible,recursivelyMarkBoxAsVisible:this.recursivelyMarkBoxAsVisible,markBoxAsHidden:this.markBoxAsHidden,recursivelyMarkBoxAsHidden:this.recursivelyMarkBoxAsHidden,trackBoxScroll:this.trackBoxScroll,isBoxInViewport:this.isBoxInViewport}}}function gt([e,t]){return null==t||0===t.length?"":Array.isArray(t)?t.map((t=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`)).join("&"):`${encodeURIComponent(e)}=${encodeURIComponent(t)}`}function bt(e,t=[]){const r=Object.fromEntries(t.map((({name:e,value:t})=>[e,t]))),o=((e,t)=>{const r=(e=>e.replace("?","").split("&").filter(Boolean).map((e=>e.split("="))).reduce(((e,[t,r])=>(e[t]?e[t].push(r):e[t]=[r],e)),{}))(e);return Object.entries(r).filter((([e])=>{const r=e.replace(/\+/g,"%20");return!Object.keys(t).map((e=>encodeURIComponent(e))).includes(r)})).map((([e,t])=>t.map((t=>`${e}=${null!=t?t:""}`)).join("&")))})(e,r),n=(e=>Object.entries(e).map(gt).filter(Boolean))(r),s=[...o,...n].join("&");return s?"?"+s:""}class ft{constructor({targetWindow:e,opboxWebClient:t,analytics:r,debugData:o,updateViewIdCallback:n,updateComponentCallback:s,beforeUpdateComponentCallback:i,reportError:a}){this.navigateRelative=(e,{persistHash:t=!1,shouldReplaceState:r=!1}={})=>{const o=new URL(this.location.href),n=this.location.search;t||(o.hash="");const s=bt(n,null==e?void 0:e.filter((e=>!e.fetchUrlOnly))),i=bt(n,e),a=o.pathname+s+o.hash;return i!==this.lastFetchParams&&this.fetch(i,fe),s!==n&&(this.changeUrl(a,r),this.changeCallbacks.forEach((e=>e())),this.targetWindow.performance.mark("clientSideNavigationStart")),a},this.refreshPage=()=>{this.fetch(this.location.search,be)},this.changeState=({queryParameters:e,hash:t,shouldChangeHistory:r})=>{if(!e&&"string"!=typeof t)return this.reportError(he),null;const o=new URL(this.location.href),n=null==e?void 0:e.filter((e=>!e.fetchUrlOnly)),s=this.location.search;o.search=bt(s,n),"string"==typeof t&&(o.hash=t);const i=this.location.pathname+o.search+o.hash;return o.href!==this.location.href&&(this.changeUrl(i,!r),this.changeStateCallbacks.forEach((e=>e()))),i},this.registerChangeCallback=e=>{this.registerCallback(e,this.changeCallbacks,ue)},this.registerChangeStateCallback=e=>{this.registerCallback(e,this.changeStateCallbacks,pe)},this.removeChangeCallback=e=>{this.changeCallbacks=this.removeCallback(e,this.changeCallbacks,me)},this.removeChangeStateCallback=e=>{this.changeStateCallbacks=this.removeCallback(e,this.changeStateCallbacks,ge)},this.targetWindow=e,this.location=e.location,this.opboxWebClient=t,this.analytics=r,this.debugData=o,this.updateViewIdCallback=n,this.updateComponentCallback=s,this.beforeUpdateComponentCallback=i,this.reportError=a,this.lastFetchParams=this.location.search,this.changeCallbacks=[],this.changeStateCallbacks=[]}initialize(){this.targetWindow.addEventListener("popstate",(e=>this.handlePopState(e)))}changeUrl(e,t=!1){t?this.targetWindow.history.replaceState("","",e):this.targetWindow.history.pushState("","",e)}handlePopState(e){const t=e.target.location.search;this.lastFetchParams!==t&&this.refreshPage()}fetch(t,r){const o=this.location.pathname+t;return this.lastFetchParams=t,this.beforeUpdateComponentCallback(),this.opboxWebClient.getPageData(o).then((e=>this.onDataChange(e))).catch((t=>{t.message!==e&&this.reportError(r,{error:t,errorContext:{path:o}})}))}onDataChange(e){const{boxes:t,meta:r}=e.resolved,{defaultCustomParams:o,viewId:n}=r;this.analytics.updateCustomParams(o,n),this.updateViewIdCallback(n),((e,t)=>{const r=e.document.querySelector('head meta[name="robots"]');r&&t&&r.setAttribute("content",[t.noindexCondition?"noindex":"index",t.nofollowCondition?"nofollow":"follow"].join(", "))})(this.targetWindow,r),Object.entries(t).forEach((([e,t])=>{void 0!==t&&this.updateComponentCallback(e,t)})),this.debugData.onRawDataChange(e)}registerCallback(e,t=[],r){"function"!=typeof e?this.reportError(r,{messageData:{type:typeof e}}):t.push(e)}removeCallback(e,t=[],{INVALID_ARG:r,UNREGISTERED_CALLBACK_REMOVAL:o}){if("function"==typeof e){const r=t.filter((t=>t!==e));return r.length===t.length&&this.reportError(o),r}return this.reportError(r,{messageData:{type:typeof e}}),t}createAPI(){return{registerChangeCallback:this.registerChangeCallback,registerChangeStateCallback:this.registerChangeStateCallback,removeChangeCallback:this.removeChangeCallback,removeChangeStateCallback:this.removeChangeStateCallback,changeState:this.changeState}}}const Et=500,vt="opboxAnimationTimerInterval",yt={easeInOutQuart(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e}};function Ct(e,t,r,o,{duration:n=Et,onFinish:s}={}){if("function"!=typeof o)return null;const i=N(),a=r-t;let l=t,c=!1;const d=()=>{const h=N()-i;if(c||h>=n)l===r||o(r),"function"==typeof s&&s(),c=!1;else{const r=Math.min(h/n,1);l=yt.easeInOutQuart(r)*a+t,o(l),e.requestAnimationFrame(d)}};return d(),{stop(){c=!0}}}function It(e,t=0,{duration:r=Et}={}){const o=e.scrollY,n=Math.max(0,t),s=e.document.body.scrollHeight;function i(){e[vt]&&"function"==typeof e[vt].stop&&(e[vt].stop(),e[vt]=null)}i(),e[vt]=Ct(e,o,t,(t=>{e.scrollTo(0,Math.round(t)),(t=>{const r=t===n||t===n,o=e.innerHeight+t>=s;return r||o})(t)&&i()}),{duration:r})}class xt{constructor(){this.status=1,this.promise=new Promise((e=>{this.resolve=e}))}registerImplementation(e){this.status=2,this.resolve(e)}}class Nt{constructor({reportError:e,allowedPlugins:t=[]}){this.addPluginToRegistry=({name:e})=>{this.isPluginAvailable(e)||this.pluginsRegistry.set(e,new xt)},this.register=(e,t)=>{if(!e)return void this.reportError(Ee);const{name:r}=e;if("string"!=typeof r)return void this.reportError(ve);if(!r)return void this.reportError(ye);if(!t)return void this.reportError(Ce);const o=this.pluginsRegistry.get(r);o?2!==o.status?o.registerImplementation(t):console.error(`Plugin "${r}" is already registered on page`):this.reportError(Ie,{messageData:{name:r}})},this.getPlugin=e=>{const t=this.pluginsRegistry.get(e);return t?t.promise:Promise.reject(Error(`Plugin "${e}" is unavailable`))},this.updateRegistry=(e=[])=>{e.forEach(this.addPluginToRegistry)},this.reportError=e,this.pluginsRegistry=new Map,this.boundUpdateRegistry=this.updateRegistry,this.updateRegistry(t)}isPluginAvailable(e){return this.pluginsRegistry.has(e)}createAPI(){return{register:this.register,get:this.getPlugin}}}function wt(e,t){return t.filter((t=>{return!e.find((r=t,e=>{if(r.url)return[e.url,e.href,e.src].includes(r.url);if(r.code){const{attributes:t={}}=r,o=!Object.keys(t).some((r=>{var o;return t[r]!==(null===(o=e.node)||void 0===o?void 0:o.getAttribute(r))}));return r.code===e.code&&o}return!1}));var r}))}function St(e,t,r,o){if(!t.length)return Promise.resolve();const n=(e=>Array.from(e.document.getElementsByTagName("script"),(e=>({src:e.src,code:e.innerHTML,nonce:e.nonce,node:e}))))(e),s=(e=>(e.find((({nonce:e})=>!!e))||{}).nonce)(n),i=wt(n,t),[a,l]=i.reduce(((e,t)=>(e[t.async?0:1].push(t),e)),[[],[]]),c=((e,t,r=g,o=g)=>{const{document:n}=e,s=w(e);return({url:e,code:i,attributes:a,type:l})=>e||i?new Promise((c=>{var d;const h=!e&&!!i,u="module"===l,p=n.createElement("script");let m=null,g=!1;const b=t=>{c(),o(Error(`Error while loading script "${e}": ${JSON.stringify(t)}`)),p.removeEventListener("error",b)},f=()=>{c(),p.removeEventListener("error",b),p.removeEventListener("load",f)};if(!u||s){if(a){if(a.nomodule&&s)return void c();Object.entries(a).forEach((([e,t])=>{"data-serialize-box-id"!==e&&"data-serialize-box-name"!==e||(g=!0,m=n.querySelector(`[${e}="${t}"]`)),p.setAttribute(e,t+"")}))}t&&p.setAttribute("nonce",t),l&&(p.type=l),h?(p.innerHTML=i,c()):(p.src=e||"",p.addEventListener("load",f),p.addEventListener("error",b)),m?null===(d=m.parentNode)||void 0===d||d.replaceChild(p,m):n.head.appendChild(p),g&&r()}else c()})):Promise.resolve()})(e,s,r,o),d=(...e)=>{return t=this,r=[...e],n=function*(e=[]){if(!e.length)return Promise.resolve();const[t,...r]=e;return yield c(t),d(r)},new((o=void 0)||(o=Promise))(((e,s)=>{function i(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(t){var r;t.done?e(t.value):(r=t.value,r instanceof o?r:new o((e=>{e(r)}))).then(i,a)}l((n=n.apply(t,r||[])).next())}));var t,r,o,n};return d(l).then((()=>Promise.all(a.map(c))))}class Pt{constructor({assetUrls:e,reportError:t}){this.assetUrls=e,this.reportError=t,this.implementation=null,this.status=0,this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}registerImplementation(e){try{this.implementation=new e,this.status=2,this.resolve(this.implementation)}catch(t){this.handleError(Ne,t)}}fetchIfNotFetched(e){if(0===this.status){this.status=1;const{module:t,nomodule:r}=this.assetUrls;St(e,[w(e)?{url:t,type:"module"}:{url:r}]).catch((e=>{this.handleError(xe,e)}))}}handleError(e,t){this.reportError(e,{error:t}),this.status=2,this.reject()}}class At{constructor({targetWindow:e,reportError:t}){this.register=({serviceName:e},t)=>{this.servicesRegistry.get(e).registerImplementation(t)},this.reportError=t,this.servicesRegistry=new Map;const r=e.document.querySelector('script[data-config="services"]');if(r)try{JSON.parse(r.textContent).forEach((([e,{nomodule:t,module:r}])=>{this.setServiceToRegistry(e,{nomodule:t,module:r})}))}catch(o){this.reportError(F,{error:o})}this.get=((e,t)=>r=>{const o=e.get(r);return o?(o.fetchIfNotFetched(t),o.promise):Promise.reject(Error(`Service ${r} is not registered`))})(this.servicesRegistry,e),this.servicesForComponent=Object.freeze({get:this.get})}getServicesForComponent(){return this.servicesForComponent}setServiceToRegistry(e,t){this.servicesRegistry.set(e,new Pt({assetUrls:t,reportError:this.reportError}))}createAPI(){return{register:this.register,get:this.get.bind(this),__dangerouslyGet__:this.get.bind(this)}}}function Ot(e,t,r,...o){if("function"==typeof e&&"function"==typeof t){if(!e.__queue__)return;n=e.__queue__,s=t,n.forEach((({args:e,reject:t,resolve:r})=>{const o=((e,t)=>{try{return e(...t)}catch(r){return void console.error(r)}})(s,e);o&&"function"==typeof o.then&&"function"==typeof r&&"function"==typeof t&&o.then(r,t)})),r(t,...o)}else d(e)&&d(t)&&Object.keys(e).forEach((n=>{Ot(e[n],t[n],r,...o.concat(n))}));var n,s}class Tt{constructor({reportError:e,ttlMs:t=2592e6,key:r="opbox.preferences",timeProvider:o=N}){this.savePreferences=e=>{const t=this.loadPreferences(),r=this.timeProvider(),o=e.reduce(x((({name:e,value:t})=>({[e]:{value:t,timestamp:r}}))),t);this.writeToStorage(o)},this.writeToStorage=e=>{try{window.localStorage.setItem(this.key,JSON.stringify(e))}catch(t){this.reportError(V,{error:t})}},this.loadPreferences=()=>{try{return JSON.parse(window.localStorage.getItem(this.key))||{}}catch(e){return this.reportError(j,{error:e}),{}}},this.cleanupPreferences=()=>{const e=this.loadPreferences(),t=this.timeProvider(),r=Object.entries(e).reduce(x((([e,r])=>r.timestamp+this.ttlMs>t?{[e]:r}:{})),{});this.writeToStorage(r)},this.ttlMs=t,this.key=r,this.timeProvider=o,this.reportError=e}}class kt{savePreferences(){}loadPreferences(){return{}}cleanupPreferences(){}}const _t="/preferences",Mt="illegal argument type provided as preferences",Lt={withCredentials:!0,headers:{"Content-Type":"application/vnd.allegro.internal.v1+json",Accept:"application/vnd.allegro.internal.v1+json"}};class Bt{constructor({edgeClient:e,ttlMs:t,reportError:r}){this.setPreference=(e,t)=>{const r={name:e,value:t};return this.storage.savePreferences([r]),this.edgeClient.post(_t,r,Lt)},this.getPreference=(e,t)=>"string"==typeof e||e instanceof String?this.getPreferences({[e]:t}).then((t=>t[e])):Promise.reject(Error("illegal argument type provided as preference name")),this.setPreferences=e=>{if(!d(e))return Promise.reject(Error(Mt));const t=Object.entries(e).map((([e,t])=>({name:e,value:t})));return this.storage.savePreferences(t),this.edgeClient.post("/preferences/multi",JSON.stringify(t),Lt).then((e=>e.data))},this.getPreferences=e=>{if(!d(e))return Promise.reject(Error(Mt));const t=Object.keys(e).join(","),r=`${_t}?name=${t}`,{withCredentials:o}=Lt,n=Lt.headers,{"Content-Type":s}=n,i=st(n,["Content-Type"]);return this.edgeClient.get(r,{withCredentials:o,headers:i}).then((({data:{preferences:e}})=>(this.storage.savePreferences(e),e.reduce(x((({name:e,value:t})=>({[e]:t}))),{})))).catch((()=>this.getPreferencesFromLocalStorageOrDefaults(e)))},this.getPreferencesFromLocalStorageOrDefaults=e=>{this.storage.cleanupPreferences();const t=this.storage.loadPreferences();return Object.entries(e).reduce(x((([e,r])=>({[e]:e in t?t[e].value:r}))),{})},this.edgeClient=e,this.storage=(()=>{try{const e="test_preferences_storage",{localStorage:t}=window;return t.setItem(e,e),t.getItem(e),t.removeItem(e),!0}catch(e){return!1}})()?new Tt({ttlMs:t,reportError:r}):new kt}createAPI(){return{set:this.setPreference,get:this.getPreference,setMany:this.setPreferences,getMany:this.getPreferences}}}const Dt=(e,t)=>{const{document:{documentElement:{clientWidth:r,clientHeight:o}},navigator:{userAgent:n}}=e,{downlink:s}=(({navigator:{connection:e,mozConnection:t,webkitConnection:r}})=>e||t||r||{})(e),i=`${r}x${o}`,a=!h(t);return Object.assign(Object.assign({device:{viewport:i,ua:n}},a&&{other:t}),s&&{connection:{speed:s}})};var Rt=["assets","spinner","button","link","badge","brand","bubble","card","chart","desk","divider","heading","hint","icon","indicator","input","list","timeline","timer","marker","notification","placeholder","price","progress","table","dropdown","breadcrumb","accordion","carousel","chip","choice","dialog","field","image-tile","input-group","message","modal","pagination","range","select","sheet","slider","soap","stepper","switch","tabs","typography","color","grid","board","calendar","datepicker","attachment","article","navigation-tiles","pin","player-video","tip","align","border","box-sizing","display","flex","height","margin","outline","padding","position","transition","utils","visibility","white-space","width","zindex","core"];function Vt(e){return Array.from(e.querySelectorAll('link[type="text/css"],style'),(e=>({href:e.href,code:e.innerHTML,media:e.media,node:e,isMetrum:p(e.href)}))).filter((({href:e,code:t})=>e||t))}function jt(e,t,r){const o=e.querySelector(r.selectors.bundledStylesMap);if(!o)return[];const{textContent:n}=o;if(!n)return t(Error("Bundled styles map: empty content")),[];try{return JSON.parse(n)}catch(s){const e=n.slice(0,100),r=n.slice(-100);return t(Error(`Bundled styles map: invalid JSON. Message: ${s.message}. Length: ${n.length}. Start: ${e}. End: ${r}`)),[]}}const Ft=["crossOrigin"],Wt=(e,{href:t,media:r,crossOrigin:o},n)=>{const s=(({document:e},t,{referenceNode:r=null}={})=>o=>{y(o,((e,t)=>!(t||Ft.includes(e))));const n=Object.assign(e.createElement("link"),o);return n.rel=t,r?r.insertAdjacentElement("afterend",n):e.head.appendChild(n),n})(e,"stylesheet",{referenceNode:n})(Object.assign({type:"text/css",href:t,media:r},{crossOrigin:o}));return new Promise(((e,t)=>{s.addEventListener("error",t),s.addEventListener("load",e)}))},Ut=e=>t=>{var r;return!!(null===(r=t.href)||void 0===r?void 0:r.includes(e+"/"))},$t=(e,t,r)=>{var o,n,s;const i=e.filter((e=>e.isMetrum)),a=t.slice(0,t.indexOf(r)).reverse().find((e=>i.find(Ut(e)))),l=a&&(null===(o=i.find(Ut(a)))||void 0===o?void 0:o.node)||null;return!l&&i.length?null===(n=i[0].node)||void 0===n?void 0:n.previousElementSibling:!l&&e.length?null===(s=e[0].node)||void 0===s?void 0:s.previousElementSibling:l};function Ht(e,t){return e.findIndex((e=>e.selectorText===t))}function Gt(e,t,r){const o=e.document.createDocumentFragment(),n=r.map((r=>{if(p(r.url))return((e,t,{href:r,media:o},n)=>{const s=m(r);return n.includes(s)?Wt(e,{href:r,media:o,crossOrigin:""},$t(t,n,s)):Promise.resolve()})(e,t,{href:r.url,media:r.media},Rt);if(r.url){const t=Object.assign(e.document.createElement("link"),Object.assign({type:"text/css",rel:"stylesheet",crossOrigin:"",href:r.url},r.media?{media:r.media}:{}));return o.appendChild(t),new Promise(((e,r)=>{t.addEventListener("error",(()=>r(Error("Loading external styles failed")))),t.addEventListener("load",e)}))}return r.code?(o.appendChild(Object.assign(e.document.createElement("style"),{textContent:r.code})),Promise.resolve()):Promise.reject(Error("Given styles have empty code/href"))}));return e.document.head.appendChild(o),Promise.all(n)}let Xt;function zt({targetWindow:e,webResponse:t,config:r,errorReporter:o}){const{svgColorMatrixFilters:n="",assets:{styles:s=[]}={}}=t;return(({document:e},t)=>{if(!t)return;const r=e.querySelector("#svg-color-matrix-filters"),o=e.createElement("div");o.innerHTML=t;const n=o.querySelector("svg");if(!n)throw Error("Failed to find svg element in html "+t);r?n.querySelectorAll("filter").forEach((e=>{r.querySelector("#"+e.getAttribute("id"))||r.appendChild(e)})):e.body.insertBefore(n,e.body.firstChild)})(e,n),((e,t,r,o)=>{if(!t.length)return Promise.resolve();const n=[...Vt(e.document),...jt(e.document,o,r)],s=wt(n,t);Xt=Xt&&!Xt.forceRefresh?Xt:((e,{cssBundle:{isEnabled:t,emptyRule:r}},o,n)=>{const s=t?(e=>Array.from(e.document.styleSheets).find((({ownerNode:e})=>{var t;return null===(t=null==e?void 0:e.hasAttribute)||void 0===t?void 0:t.call(e,"data-metrum-bundle")})))(e):null;let i=[];const a=e=>r.pattern.replace(r.replacementPart,e);return{isEnabled:t,inject(r){if(!t)return Promise.resolve();const[l,c]=((e,t)=>t.reduce((([t,r],o)=>(e.includes(o)||r.push(o),t.push(o),[t,r])),[[],[]]))(i,r);return i=l,c.length?((e,t)=>{const r=e.createDocumentFragment(),o=t.map((t=>Object.assign(e.createElement("link"),{type:"text/css",rel:"stylesheet",crossOrigin:"",href:t,media:"not all"}))),n=o.map((e=>new Promise(((t,o)=>{e.addEventListener("load",(()=>{t(e.sheet)})),e.addEventListener("error",o),r.appendChild(e)})))),s=()=>{o.forEach((e=>{e.remove()}))};return e.head.appendChild(r),Promise.all(n).then((e=>[e,s]))})(e.document,c).then((([e,t])=>{e.forEach((e=>{if(!s)return void n(Error("Received invalid metrum bundle "+s));const t=Array.from(s.cssRules),r=t.length;if(((e,t)=>t.cssRules.length>0&&e.findIndex((e=>e.cssText===t.cssRules[0].cssText))>-1)(t,e))return;const i=m(e.href),l=o.indexOf(i),c=-1!==l?o.slice(l):[];let d=r;for(let o=0;o<c.length;o+=1){const e=Ht(t,a(c[o]));if(e>0){d=e;break}}const h=Array.from(e.cssRules);h.unshift({cssText:a(i)+"{}"});for(let o=0;o<h.length;o+=1)s.insertRule(h[o].cssText,d+o)})),t()})):Promise.resolve()}}})(e,r,Rt,o);const{inject:i,isEnabled:a}=Xt,[l,c]=s.reduce(((e,t)=>p(t.url)&&a?(e[0].push(t.url),e):(e[1].push(t),e)),[[],[]]);return Promise.all([Gt(e,n,c),i(l)])})(e,s,r,o)}function qt({targetWindow:e,webResponse:t,updateSerializedPropsCollectionCallback:r,errorReporter:o}){const{assets:{scripts:n=[]}={}}=t;return St(e,n,r,o)}var Jt=({config:e,targetWindow:t,unmountNodeCallback:r,mountNodeCallback:o,updateAllowedPluginsCallback:n,updateSerializedPropsCollectionCallback:s,updateComponentNodesCollectionCallback:i,updateDebugDataCallback:a,injectStylesAndFilters:l=zt,injectScripts:c=qt,componentNodesFinder:d,errorReporter:h})=>{const{document:u}=t;return({boxId:p,data:m,isPlaceholder:g})=>{const{htmlString:b="",allowedPlugins:f=[],debugData:E,boxEntries:v=[]}=m||{};return n(f),l({targetWindow:t,webResponse:m,config:e,errorReporter:h}).then((()=>{const e=d.findByBoxId(p,g);if(!e)throw Error("could not find placeholder node / node to replace in subtree rerender");const{node:t}=e;r(t);const o=t.parentNode;if(!b)return null==o||o.removeChild(t),{shouldMountNode:!1,nodes:[]};const n=Object.assign(u.createElement("div"),{innerHTML:b}),s=Array.from(n.children);return t.replaceWith(...s),{shouldMountNode:!0,nodes:s}})).then((({shouldMountNode:e,nodes:r})=>(i(v),c({targetWindow:t,webResponse:m,updateSerializedPropsCollectionCallback:s,errorReporter:h}).then((()=>{e&&r.forEach((e=>o(e)))}))))).then((()=>{E&&a(E,p)}))}},Qt=({config:e,targetWindow:t,unmountNodeCallback:r,mountNodeCallback:o,updateAllowedPluginsCallback:n,updateSerializedPropsCollectionCallback:s,updateComponentNodesCollectionCallback:i,updateDebugDataCallback:a,injectStylesAndFilters:l=zt,injectScripts:d=qt,setFragmentAnalyticsContext:h,deleteFragmentAnalyticsContext:u,errorReporter:p})=>{const{document:m}=t;function g(e){return m.querySelector(`[${c}="${e}"]`)}function b(e,t,r){const o=Object.assign(m.createElement("div"),{innerHTML:t});return o.setAttribute(c,e),r&&h(o,r),o}return({pathname:c,data:h})=>{const{htmlString:f="",allowedPlugins:E=[],analyticsContext:v={},debugData:y,boxEntries:C=[]}=h||{};return n(E),l({targetWindow:t,webResponse:h,config:e,errorReporter:p}).then((()=>{const e=g(c);if(!e&&f){const e=b(c,f,v);return m.body.appendChild(e),!0}if(e){if(r(e),u(e),!f)return e.parentNode.removeChild(e),!1;const t=b(c,f,v);return e.parentNode.replaceChild(t,e),!0}return!1})).then((e=>{i(C),d({targetWindow:t,webResponse:h,updateSerializedPropsCollectionCallback:s,errorReporter:p}).then((()=>e&&o(g(c))))})).then((()=>{y&&a(y)}))}},Kt=({config:e,targetWindow:t,unmountNodeCallback:r,mountNodeCallback:o,updateAllowedPluginsCallback:n,updateSerializedPropsCollectionCallback:s,updateComponentNodesCollectionCallback:i,updateDebugDataCallback:a,injectStylesAndFilters:l=zt,injectScripts:c=qt,componentNodesFinder:d,errorReporter:h})=>({data:u,boxId:p,slotName:m,slotWrapper:g})=>{const{htmlString:b="",allowedPlugins:f=[],debugData:E,boxEntries:v=[]}=u||{};return n(f),l({targetWindow:t,webResponse:u,config:e,errorReporter:h}).then((()=>(d.findSlotBoxes(p,m).forEach((({node:e})=>{var t;r(e),null===(t=e.parentNode)||void 0===t||t.removeChild(e)})),!!b&&(g.innerHTML=b,!0)))).then((e=>(i(v),c({targetWindow:t,webResponse:u,updateSerializedPropsCollectionCallback:s,errorReporter:h}).then((()=>{e&&d.findSlotBoxes(p,m).forEach((e=>{o(e.node)}))}))))).then((()=>{E&&a(E,p,m)}))};const Yt=(e,t="")=>e+t;class Zt{constructor(e,t,r){this.observedElements={},this.downloaded=[],this.registered=[],this.dependencyMapCache=[],this.observer=null,this.observerEntriesHandler=e=>{e.forEach((e=>{var t;if(!e.isIntersecting)return;const r=this.componentNodesFinder.findByNode(e.target);if(!r){const r=this.targetWindow.document.contains(e.target);if(!r)return;const o=null===(t=e.target)||void 0===t?void 0:t.dataset,n=void 0!==this.componentNodesFinder.findByBoxId(null==o?void 0:o.boxId),s=JSON.stringify({prototypeId:null==o?void 0:o.prototypeId,boxName:null==o?void 0:o.boxName,civ:null==o?void 0:o.civ});return void this.reportError(B,{errorContext:{isPartOfDocument:r,data:s,canBeFoundByBoxId:n}})}const{boxEntry:{prototypeId:o,clientImplementationVersion:n}}=r,s=this.getDependencyMapEntry(o,n),i=Yt(o,n);this.isDownloaded(i)||(this.markAsDownloaded(i),this.unobserveAllUnderKey(i),s?St(this.targetWindow,s.scripts):this.reportError(D,{messageData:{prototypeId:o,clientImplementationVersion:n}}))}))},this.onPrototypeRegistered=(e,t)=>{const r=Yt(e,t);this.registered.push(r)},this.targetWindow=e,this.reportError=r,this.componentNodesFinder=t}createObserverInstance(){this.observer||(this.observer=new this.targetWindow.IntersectionObserver(this.observerEntriesHandler,{rootMargin:"800px",threshold:0}))}markAsDownloaded(e){this.downloaded.push(e)}isDownloaded(e){return this.downloaded.includes(e)}markAsRegistered(e){this.registered.push(e)}isRegistered(e){return this.registered.includes(e)}observeElement(e,t){this.observedElements[t]=[...this.observedElements[t]||[],e],this.observer.observe(e)}unobserveAllUnderKey(e){this.observedElements[e].forEach((e=>this.observer.unobserve(e)))}getDependencyMapEntry(e,t=""){return this.dependencyMapCache.find((({prototypeId:r,clientImplementationVersion:o=""})=>r===e&&o===t))}observeComponents(e){e.forEach((e=>{const{prototypeId:t,clientImplementationVersion:r}=e,o=this.componentNodesFinder.find(t,r),n=Yt(t,r);o.forEach((({node:e})=>{this.observeElement(e,n)}))}))}handleSSRAssets(){const{document:e}=this.targetWindow;P(e,(()=>{this.dependencyMapCache=((e,t)=>{const r=e.querySelector('script[data-config="lazy-scripts-map"]'),o=[];if(!r)return o;try{return JSON.parse(r.textContent||"")}catch(n){return t(L),o}})(e,this.reportError),h(this.dependencyMapCache)||(this.createObserverInstance(),this.observeComponents(this.dependencyMapCache))}))}}function er(e,t){return e.contains(t)}function tr(e){return""===e.identity.identityAttributeValue?`[${e.identity.identityAttribute}]`:`[${e.identity.identityAttribute}*="${e.identity.identityAttributeValue}"]`}class rr{constructor({targetWindow:e,config:t,reportError:r}){this.document=e.document,this.collection=[],this.config=t,this.reportError=r,this.updateNodesCollection(),this.reportNotRenderedBoxes(this.config.boxEntries)}updateNodesCollection(e=[]){e.length&&(e.forEach((e=>{if(!e.slotName||!e.parentBoxId){const t=this.config.boxEntries.find((t=>t.boxId===e.boxId));e.parentBoxId=(null==t?void 0:t.parentBoxId)||null,e.slotName=(null==t?void 0:t.slotName)||null}})),this.config.boxEntries.push(...e));const t=this.config.boxEntries.map((e=>({node:this.document.querySelector(tr(e)),boxEntry:e}))).filter((({node:e})=>e)),r=new Set(this.collection.map((({boxEntry:e})=>e))),o=new Set(t.map((({boxEntry:e})=>e)));this.config.boxEntries=this.config.boxEntries.filter((e=>!(r.has(e)&&!o.has(e)))),this.collection=t,e.length&&this.reportNotRenderedBoxes(e)}reportNotRenderedBoxes(e){if(!this.reportError)return;const t=new Map;e.forEach((e=>{var r;if(!this.collection.find((t=>t.boxEntry.boxId===e.boxId))){const o=this.findFirstRenderedParent(e.boxId);t.get(null==o?void 0:o.boxName)||t.set(null==o?void 0:o.boxName,[]),null===(r=t.get(null==o?void 0:o.boxName))||void 0===r||r.push({parent:o,slot:e})}})),t.forEach((e=>{const{parent:t}=e[0];if(t){const r=e.filter((({slot:e})=>t.boxId===e.parentBoxId)),o=Array.from(new Set(r.map((({slot:{slotName:e}})=>`"${e}"`))));o.sort(((e,t)=>e.localeCompare(t)));const n=o.join(",");this.reportError(J,{messageData:Object.assign({slotList:n},t),errorContext:{notRenderedDirectChildren:JSON.stringify(r.map((({slot:{boxName:e,prototypeId:t}})=>({boxName:e,prototypeId:t})))),tags:{scId:t.scId}}})}else e.forEach((({slot:e})=>{this.reportError(Q,{messageData:Object.assign({},e),errorContext:{trace:JSON.stringify(this.getBoxPath(e.boxId).map((({boxName:e,prototypeId:t})=>({boxName:e,prototypeId:t}))))}})}))}))}getBoxPath(e){const t=this.config.boxEntries.find((t=>(null==t?void 0:t.boxId)===e));if(!(null==t?void 0:t.parentBoxId))return[];const r=this.config.boxEntries.find((e=>e.boxId===(null==t?void 0:t.parentBoxId)));if(!r)return[];const o=this.getBoxPath(r.boxId);return o.unshift(r),o}find(e,t){return t?this.collection.filter((({boxEntry:r})=>r.prototypeId===e&&r.clientImplementationVersion===t)):this.collection.filter((({boxEntry:t})=>t.prototypeId===e))}findFirstRenderedParent(e){const t=this.config.boxEntries.find((t=>(null==t?void 0:t.boxId)===e));if(!(null==t?void 0:t.parentBoxId))return;const r=this.config.boxEntries.find((e=>e.boxId===(null==t?void 0:t.parentBoxId)));return r?this.collection.find((e=>e.boxEntry.boxId===r.boxId))?r:this.findFirstRenderedParent(r.boxId):void 0}findClosestAncestor(e){var t;const r=this.collection.filter((({node:t})=>er(t,e))),o=r.filter((({node:e})=>!r.filter((t=>t.node!==e)).some((t=>er(e,t.node)))))[0];if(o)return o;let n=e.closest(`[${Ge}]`);return n||(n=e.closest(`[${Xe}]`)),n?{boxEntry:{boxId:n.getAttribute("data-box-id")||"",boxName:n.getAttribute(Ge)||"",analytics:{category:n.getAttribute(Xe)||"",groups:JSON.parse(decodeURIComponent(n.getAttribute("data-analytics-groups")||"")||"[]"),tags:(null===(t=n.getAttribute(ze))||void 0===t?void 0:t.split(","))||[]}},node:n}:null}findByBoxId(e,t=!1){return this.collection.find((r=>t?r.boxEntry.placeholderFor===e:r.boxEntry.boxId===e))}findSlotBoxes(e,t){return this.collection.filter((r=>r.boxEntry.parentBoxId===e&&r.boxEntry.slotName===t))}findByNode(e){return this.collection.find((t=>t.node===e))}findBySlug(e){return this.collection.find((t=>t.boxEntry.slug===e))}findSubtree(e){return this.collection.filter((t=>er(e,t.node)))}getBlameTags(e){var t,r;try{const o=this.findClosestAncestor(e);return(null===(t=null==o?void 0:o.boxEntry)||void 0===t?void 0:t.scId)?{tags:{scId:null===(r=null==o?void 0:o.boxEntry)||void 0===r?void 0:r.scId}}:{tags:{}}}catch(o){return{tags:{}}}}findAllPlaceholders(){return this.collection.filter((e=>e.boxEntry.placeholderFor))}}class or{constructor(){this.listeners=new Map}addEventListener(e,t){const r=this.listeners.get(e)||new Set;r.add(t),this.listeners.set(e,r)}removeEventListener(e,t){const r=this.listeners.get(e);r&&(r.delete(t),this.listeners.set(e,r))}trigger(e){const t=this.listeners.get(e.type);t&&t.forEach((t=>t(e)))}}const nr=(e,t,r)=>e.map((e=>Object.assign(Object.assign({},e),{updatedAt:r,rawParameters:t.resolveAll(e.rawParameters),slots:e.slots.map((e=>Object.assign(Object.assign({},e),{boxes:nr(e.boxes,t,r)})))}))),sr=(e,t,r)=>e.map((e=>{const o=t.get(e.boxId)||t.get(e.name);return Object.assign(Object.assign({},e),{updatedAt:o?r:e.updatedAt,rawParameters:o||e.rawParameters,slots:e.slots.map((e=>Object.assign(Object.assign({},e),{boxes:sr(e.boxes,t,r)})))})})),ir=(e,t,r)=>{for(const o of e){if(t(o))return{parentSlot:r,box:o};if(o.slots)for(const e of o.slots){const r=ir(e.boxes,t,e);if(r)return r}}};class ar{constructor({targetWindow:e,reportError:t,componentNodesFinder:r}){this.initialize=()=>{const e=this.window.document.getElementById("page-debug-data");if(!e)return void this.disableCallbackQueueing();let t;try{t=JSON.parse(e.textContent)}catch(r){return this.disableCallbackQueueing(),void this.reportError(M)}this.updateData(t),this.initialized=!0,this.eventBus.trigger(new CustomEvent("init",{detail:this.getData()}));for(const o of this.queuedStructureChanges)o(),this.triggerUpdateEvent();this.clearQueuedCallbacks()},this.updateData=(e,t,r)=>{if(!e)return;const o=this.debugData;this.debugData=Object.assign(Object.assign({},o),e);const n=e.pageDefinition.dataSources.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.name]:t})),{}),s=new O(n);if(e.boxes.length>0){const o=Date.now(),n=nr(e.boxes,s,o);t?this.boxes=r?((e,t,r,o)=>{const n=ir(e,(e=>e.boxId===t));if(null==n?void 0:n.box){const e=n.box.slots.find((e=>e.name===r));e&&(e.boxes=o)}return e})(this.boxes,t,r,n):((e,t,r)=>{const o=e=>e.placeholderFor===t,n=ir(e,o);if(null==n?void 0:n.parentSlot)n.parentSlot.boxes=n.parentSlot.boxes.flatMap((e=>e===n.box?r:e));else if(null==n?void 0:n.box)return e.flatMap((e=>o(e)?r:e));return e})(this.boxes,t,n):this.boxes.push(...n)}if(e.plugins.length>0){const t=((e,t)=>e.map((e=>Object.assign(Object.assign({},e),{parameters:t.resolveAll(e.parameters)}))))(e.plugins,s);for(const e of t){const t=this.plugins.get(e.name);t?this.plugins.set(e.name,Object.assign(Object.assign({},t),{parameters:e.parameters})):this.plugins.set(e.name,e)}}for(const a of e.services)this.services.has(a.name)||this.services.set(a.name,a);this.debugData.pageDefinition.failedBoxesCount+=(null==o?void 0:o.pageDefinition.failedBoxesCount)||0;const i=e=>{this.debugData.pageDefinition[e]=[...(null==o?void 0:o.pageDefinition[e])||[],...this.debugData.pageDefinition[e]||[]]};i("failedBoxes"),i("failedPlugins"),i("failedDataSources")},this.onSubtree=(e,t,r)=>{this.execOrQueueStructureChange((()=>{this.updateData(e,t,r)}))},this.onRawDataChange=e=>{this.execOrQueueStructureChange((()=>{this.boxes=sr(this.boxes,new Map(Object.entries(e.resolvedBoxes)),Date.now())}))},this.execOrQueueStructureChange=e=>{this.initialized?(e(),this.triggerUpdateEvent()):this.allowCallbackQueue&&this.queuedStructureChanges.push(e)},this.getData=()=>this.initialized&&this.debugData?Object.assign(Object.assign({},this.debugData),{boxes:this.boxes,plugins:Array.from(this.plugins.values()),services:Array.from(this.services.values())}):null,this.addEventListener=(e,t)=>{this.eventBus.addEventListener(e,t)},this.removeEventListener=(e,t)=>{this.eventBus.removeEventListener(e,t)},this.disableCallbackQueueing=()=>{this.allowCallbackQueue=!1,this.clearQueuedCallbacks()},this.clearQueuedCallbacks=()=>{this.queuedStructureChanges=[]},this.triggerUpdateEvent=()=>{this.eventBus.trigger(new CustomEvent("update",{detail:this.getData()}))},this.createAPI=()=>({get:this.getData,addListener:this.addEventListener,removeListener:this.removeEventListener,findClosestAncestor:this.componentNodesFinder.findClosestAncestor.bind(this.componentNodesFinder)}),this.window=e,this.initialized=!1,this.reportError=t,this.eventBus=new or,this.boxes=[],this.plugins=new Map,this.services=new Map,this.allowCallbackQueue=!0,this.queuedStructureChanges=[],this.componentNodesFinder=r,P(this.window.document,(()=>{((e,t)=>{e.requestAnimationFrame((()=>{S(t)}))})(this.window,(()=>this.initialize()))}))}}function lr(e){return d(e)&&!("clientImplementationVersion"in e)?Object.assign(e,{clientImplementationVersion:""}):e}function cr({instance:e,method:t,reportError:r,data:o=null,onSuccess:n=()=>{},blameTags:s}){if(e&&"function"==typeof e[t])try{e[t](o),n()}catch(i){r(q,{error:i,messageData:{method:t},errorContext:s})}}function dr(e,t){return""===t?e:`${e}@${t}`}const hr="data-serialize-box-id",ur="data-serialize-box-name",pr=`script[${hr}], script[${ur}]`;class mr{constructor(e,t){this.collection=[],this.targetWindow=e,this.reportError=t,this.updateNodesCollection()}updateNodesCollection(){this.collection=Array.from(this.targetWindow.document.querySelectorAll(pr))}getNodeByBoxId(e){return this.collection.find((t=>t.getAttribute(hr)===e))}getNodeByBoxName(e){return this.collection.find((t=>t.getAttribute(ur)===e))}getPropsFromNode(e,t,r){if(!e)return{};try{return JSON.parse(e.textContent||"")}catch(o){return this.reportError(R,{error:o,messageData:{boxName:r,boxId:t}}),{}}}getPropsForBox(e,t){const r=this.getNodeByBoxId(e)||this.getNodeByBoxName(t);return r?this.getPropsFromNode(r,e,t):{}}}class gr{constructor({targetWindow:e,services:t,reportError:r,unmountNodeCallback:o,mountNodeCallback:n,componentNodesFinder:s,registerPrototypeCallback:i}){this.unmountNode=e=>{this.unmountNodeCallback(e),this.componentNodesFinder.findSubtree(e).forEach((({boxEntry:e})=>{const t=e.boxId||e.boxName;cr({instance:this.instances.get(t),method:"onUnmount",reportError:this.reportError,blameTags:this.getBlameTagsForMountedInstance(t)}),this.instances.set(t,null),this.blameTags.set(t,null)}))},this.mountNode=e=>{this.componentNodesFinder.findSubtree(e).forEach((({boxEntry:e,node:t})=>{const r=e.prototypeId,o=e.clientImplementationVersion||"";this.registerInstancesForPrototype(r,o,[{boxEntry:e,node:t}])})),this.mountNodeCallback(e)},this.updateComponentCallback=(e,t)=>{const r=this.instances.get(e);r?S((()=>{cr({instance:r,method:"onUpdate",reportError:this.reportError,data:t,blameTags:this.getBlameTagsForMountedInstance(e)})})):this.boxDataCache.set(e,t)},this.beforeUpdateComponentCallback=()=>{this.instances.forEach(((e,t)=>cr({instance:e,method:"beforeOnUpdate",reportError:this.reportError,blameTags:this.getBlameTagsForMountedInstance(t)})))},this.register=(e,t)=>{const r=(e=>Array.isArray(e)?e.map(lr):lr(e))(e);this.isPrototypeValid(r)&&this.isImplementationValid(t)&&(Array.isArray(r)?r.forEach((e=>{this.registerImplementationAndInstances(e,t)})):this.registerImplementationAndInstances(r,t))},this.updateSerializedPropsCollection=()=>{this.serializedPropsFinder.updateNodesCollection()},this.updateComponentNodesCollection=e=>{this.componentNodesFinder.updateNodesCollection(e)},this.services=t,this.implementations=new Map,this.instances=new Map,this.blameTags=new Map,this.boxDataCache=new Map,this.reportError=r,this.unmountNodeCallback=o,this.mountNodeCallback=n,this.registerPrototypeCallback=i,this.serializedPropsFinder=new mr(e,r),this.componentNodesFinder=s}isPrototypeObjectValid(e){const{prototypeName:t,clientImplementationVersion:r}=e;return"prototypeName"in e?""===t?(this.reportError(te),!1):"string"!=typeof t?(this.reportError(re,{messageData:{type:typeof t}}),!1):"string"!=typeof r?(this.reportError(oe,{messageData:{type:typeof r}}),!1):(""===r&&this.reportError(de),!0):(this.reportError(ee),!1)}containsValidPrototypes(e){return 0===e.length?(this.reportError(ne),!1):!e.filter((e=>!this.isPrototypeObjectValid(e))).length}isPrototypeValid(e){return Array.isArray(e)?this.containsValidPrototypes(e):d(e)?this.isPrototypeObjectValid(e):(this.reportError(se),!1)}isImplementationValid(e){return"function"!=typeof e?(this.reportError(ie),!1):e.prototype.onUpdate&&"function"!=typeof e.prototype.onUpdate?(this.reportError(ae,{messageData:{type:typeof e.prototype.onUpdate}}),!1):"function"==typeof e.prototype.onMount||(this.reportError(le),!1)}registerInstancesForPrototype(e,t,r){const o=this.implementations.get(dr(e,t));o&&(this.registerInstances(r,this.services.getServicesForComponent(),o),this.registerPrototypeCallback(e,t))}registerImplementationAndInstances({prototypeName:e,clientImplementationVersion:t},r){const o=dr(e,t),n=""===t;this.implementations.has(o)?this.reportError(ce,{messageData:{prototypeName:e,implementationVersionMessage:n?"":`with ${t} client implementation version`}}):(this.implementations.set(o,r),this.registerInstancesForPrototype(e,t,this.componentNodesFinder.find(e,t)))}static createBlameTags(e){return e?{tags:{scId:e}}:{tags:{}}}getBlameTagsForMountedInstance(e){return this.blameTags.get(e)||gr.createBlameTags(null)}registerInstances(e,t,r){e.forEach((({node:e,boxEntry:o})=>{if(null==e?void 0:e.getAttribute(c))return;const{boxId:n,boxName:s,scId:i}=o,a=n||s;S((()=>{if(this.instances.get(a))return;const o=this.serializedPropsFinder.getPropsForBox(n,s),l=new r({baseNode:e,props:o,services:t,boxEntry:{boxId:n}}),c=gr.createBlameTags(i);cr({instance:l,method:"onMount",reportError:this.reportError,blameTags:c,onSuccess:()=>{this.instances.set(a,l),this.blameTags.set(a,c)}}),this.boxDataCache.has(a)&&(cr({instance:l,method:"beforeOnUpdate",reportError:this.reportError,blameTags:c}),this.updateComponentCallback(a,this.boxDataCache.get(a)),this.boxDataCache.delete(a))}))}))}createAPI(){return{register:this.register}}}const br=new class{constructor(e,t,r){this.lazyloadedElement=({target:e})=>{this.componentNodesFinder.findByNode(e)||this.componentNodesFinder.updateNodesCollection();const t=this.componentNodesFinder.findByNode(e);if(t&&t.boxEntry.placeholderFor){const e={boxId:t.boxEntry.placeholderFor,isPlaceholder:!0};this.opboxWebClient.render.box(e)}},this.attach=()=>{const e=s(this.targetWindow),t=this.API;var r,o;e&&(Ot(e,t,((t,...r)=>((e,t)=>{e[n]=e[n]||{},Object.keys(t).forEach((r=>{e[n][r]=t[r]}))})(this.targetWindow,E(e,t,...r)))),r=e,o=Object.keys(t).concat("initialized","config"),y(r,(e=>!o.includes(e))),Object.freeze(e)),this.broadcastAPILoadEvent(),this.targetWindow.addEventListener("lazyloaded",this.lazyloadedElement),this.updateInlinePreference(),t.performance.markTimeToInteractive("sc-12453")},this.targetWindow=e,this.document=e.document;const o=(e=>s(e).config)(e),i=new ht({targetWindow:e,config:o}),a=(e=>(t,r={})=>{if(0===t.status)return;const{tags:o}=r,n=st(r,["tags"]);e.opbox.plugin.get("sentry").then((r=>r.captureException(t,Object.assign({contexts:Dt(e,n)},!h(o)&&{tags:o})))).catch(g)})(e),l=((e,t,r)=>(o,{error:n,messageData:s={},errorContext:i={}}={})=>{const a=n,l=[o,ke[o](s),null==a?void 0:a.message].filter(Boolean).join(" "),c=Error(l);(null==a?void 0:a.stack)&&(c.stack=a.stack),(null==r?void 0:r.opboxWebBrowserDocs)&&(e.console.group(`${r.opboxWebBrowserDocs}/tagged-errors/#${o}`),e.console.error(c),e.console.log("contextData",i),e.console.groupEnd()),t(c,i)})(e,a,o.links),c=new rr({targetWindow:e,config:o,reportError:l}),d=new mt({targetWindow:e,componentNodesFinder:c}),u=new nt({targetWindow:e,config:o,cookieMonsterClient:i,boxViewsMarker:d,reportError:l,componentNodesFinder:c}),p=new At({targetWindow:e,reportError:l}),m=new Zt(e,c,l),b=new gr({targetWindow:e,services:p,reportError:l,componentNodesFinder:c,registerPrototypeCallback:m.onPrototypeRegistered,unmountNodeCallback:d.unmountNode,mountNodeCallback:d.markBoxAsRendered}),f=new Nt({reportError:l,allowedPlugins:o.allowedPlugins}),v=new ar({targetWindow:e,reportError:l,componentNodesFinder:c}),C={config:o,targetWindow:e,unmountNodeCallback:b.unmountNode,mountNodeCallback:b.mountNode,updateSerializedPropsCollectionCallback:b.updateSerializedPropsCollection,updateComponentNodesCollectionCallback:b.updateComponentNodesCollection,updateAllowedPluginsCallback:f.boundUpdateRegistry,updateDebugDataCallback:v.onSubtree,setFragmentAnalyticsContext:u.setFragmentAnalyticsContext,deleteFragmentAnalyticsContext:u.deleteFragmentAnalyticsContext,componentNodesFinder:c,errorReporter:a},I=new Le({config:o,targetWindow:e,httpClient:t,reportError:l,boxRenderCallback:Jt(C),fragmentRenderCallback:Qt(C),slotRenderCallback:Kt(C),componentNodesFinder:c});this.config=o,this.cookieMonsterClient=i,this.boxViewsMarker=d,this.analytics=u,this.services=p,this.components=b,this.opboxWebClient=I,this.plugins=f,this.reportError=a,this.lazyScriptsManager=m,this.debugData=v,this.componentNodesFinder=c,this.navigation=new ft({targetWindow:e,opboxWebClient:I,analytics:u,debugData:v,updateViewIdCallback:I.updateViewId,updateComponentCallback:b.updateComponentCallback,beforeUpdateComponentCallback:b.beforeUpdateComponentCallback,reportError:l}),this.edgeClient=new lt({httpClient:r,edgeHost:o.edgeHost,config:o}),this.edgeUploadClient=new lt({httpClient:r,edgeHost:o.edgeUploadHost,config:o}),this.preferencesClient=new Bt({edgeClient:this.edgeClient,reportError:l}),this.uiTools=((e,t)=>{const{document:r}=e,o=(o,{animate:n=!0}={})=>{const s={duration:n?500:0};if("number"==typeof o)return void It(e,o,s);const i=(a=o,null===(l=t.findBySlug(a))||void 0===l?void 0:l.node);var a,l;if(i){const t=(t=>{const o=e.scrollY||r.documentElement.scrollTop||0;return t.getBoundingClientRect().top+o})(i);It(e,t,s)}};return{scrollTo:o,scrollToLocationHash(){if(e.location.hash){const t=e.location.hash.substring(1);o(t,{animate:!1})}},tween:(...t)=>Ct(e,...t)}})(e,c),m.handleSSRAssets(),u.initialize(),this.navigation.initialize(),d.initialize()}get API(){return{analytics:this.analytics.createAPI(),boxViewsMarker:this.boxViewsMarker.createAPI(),component:this.components.createAPI(),plugin:this.plugins.createAPI(),changeParams:this.navigation.navigateRelative,refreshPage:this.navigation.refreshPage,tween:this.uiTools.tween,scrollTo:this.uiTools.scrollTo,page:this.opboxWebClient.createAPI(),navigation:this.navigation.createAPI(),edge:this.edgeClient.createAPI(),edgeUpload:this.edgeUploadClient.createAPI(),preferences:this.preferencesClient.createAPI(),loaded:!0,performance:s(this.targetWindow).performance,services:this.services.createAPI(),reportError:this.reportError,__internal__debug:this.debugData.createAPI()}}renderBoxForLazyloadedPlaceholders(){this.componentNodesFinder.findAllPlaceholders().filter((({node:e})=>e.classList.contains("lazyloaded"))).forEach((({boxEntry:e})=>{const t={boxId:e.placeholderFor,isPlaceholder:!0};this.opboxWebClient.render.box(t)}))}updateInlinePreference(){const{config:e,preferencesClient:t}=this;e.cssBundle&&e.cssBundle.shouldInline&&t.setPreference("receivedInline",!0)}broadcastAPILoadEvent(){f(this.targetWindow,"opboxAPILoaded")}run(){this.attach(),this.uiTools.scrollToLocationHash(),this.renderBoxForLazyloadedPlaceholders()}}(window,o(),o());setTimeout((()=>{br.run()}),0);const{attach:fr}=br;
//# sourceMappingURL=opbox-63iXb52M.es6.js.map
