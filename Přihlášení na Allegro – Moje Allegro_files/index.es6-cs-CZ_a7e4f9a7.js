import*as t from"https://assets.allegrostatic.com/sc-23670/preact-2579e.js";var e,a,i=[(t,e,a)=>{a.d(e,{a:()=>s,b:()=>i});const i={Agent:"Agent",Chatbot:"Chatbot",Client:"Client",System:"System"},s={Agent:i.Agent,Chatbot:i.Chatbot,None:""}},(t,e,a)=>{a.d(e,{a:()=>i});const i={Minimized:"Minimized",Normal:"Normal"}},(t,e,a)=>{a.d(e,{a:()=>l,b:()=>r,c:()=>n,d:()=>o});var i=a(11);const s=localStorage||{getItem:()=>null,setItem(){},removeItem(){},clear(){},key:()=>null,length:0},n=()=>null!==s.getItem(i.a),r=t=>{try{const e=s.getItem(i.a)||"";return JSON.parse(e).conversations[t]||{}}catch(e){return{}}},o=(t,e)=>{const a=r(t),n={conversations:{[t]:Object.assign(Object.assign({},a),e)}};s.setItem(i.a,JSON.stringify(n))},l=()=>s.removeItem(i.a)},(t,e,a)=>{a.d(e,{a:()=>i});const i={Dependent:"Dependent",Standalone:"Standalone",WebView:"WebView"}},(t,e,a)=>{a.d(e,{a:()=>c,b:()=>h});const i="MobileApp",s="Mweb",n=/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/gi,r=/allegro/i,o=/client-id/i,l=()=>{const{userAgent:t}=navigator,e=t.match(r),a=t.match(o);return e&&a?i:t.match(n)?s:"Other"},c=()=>l()===i,h=()=>l()===s},(t,e,a)=>{a.d(e,{a:()=>i});const i=new class{constructor(){this.listeners=[],this.memoizedStream=new Map}emit(t,e){this.memoizedStream.set(t,e),this.listeners.filter((e=>e.event===t)).forEach((t=>setTimeout((()=>t.subscriber(e)),0)))}subscribe(t,e){const a={event:t,subscriber:e};if(this.listeners=[...this.listeners,a],this.memoizedStream.has(t)){const e=this.memoizedStream.get(t);this.emit(t,e)}return{unsubscribe:this.unsubscribe.bind(this,a)}}unsubscribe(t){this.listeners=this.listeners.filter((e=>e!==t))}}},,(t,e,a)=>{function i(t,e){if(null==t)return{};var a,i,s=((t,e)=>{if(null==t)return{};var a,i,s={},n=Object.keys(t);for(i=0;i<n.length;i++)a=n[i],e.indexOf(a)>=0||(s[a]=t[a]);return s})(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(i=0;i<n.length;i++)a=n[i],e.indexOf(a)>=0||{}.propertyIsEnumerable.call(t,a)&&(s[a]=t[a])}return s}a.d(e,{a:()=>i})},(t,e,a)=>{a.d(e,{a:()=>i});const i=()=>window.opbox.config.language},(t,e,a)=>{a.d(e,{a:()=>n,b:()=>s,c:()=>i});const i=()=>{},s=()=>null,n=()=>Promise.resolve()},(t,e,a)=>{a.d(e,{a:()=>i});const i=t=>({timestamp:(new Date).setMilliseconds(0),value:t})},(t,e,a)=>{a.d(e,{a:()=>i});const i="chat.preferences"},(t,e,a)=>{a.d(e,{a:()=>i});const i=t=>console.warn(t)},(e,a,i)=>{var s,n;e.exports=(s={Component(){return t.default.preact.Component},Fragment(){return t.default.preact.Fragment},cloneElement(){return t.default.preact.cloneElement},createContext(){return t.default.preact.createContext},h(){return t.default.preact.h},render(){return t.default.preact.render},toChildArray(){return t.default.preact.toChildArray}},n={},i.d(n,s),n)},(e,a,i)=>{var s,n;e.exports=(s={useCallback(){return t.default["preact/hooks"].useCallback},useContext(){return t.default["preact/hooks"].useContext},useEffect(){return t.default["preact/hooks"].useEffect},useMemo(){return t.default["preact/hooks"].useMemo},useRef(){return t.default["preact/hooks"].useRef},useState(){return t.default["preact/hooks"].useState}},n={},i.d(n,s),n)},(e,a,i)=>{var s,n;e.exports=(s={Suspense(){return t.default["preact/compat"].Suspense},forwardRef(){return t.default["preact/compat"].forwardRef},lazy(){return t.default["preact/compat"].lazy},memo(){return t.default["preact/compat"].memo}},n={},i.d(n,s),n)}],s={};function n(t){var e=s[t];if(void 0!==e)return e.exports;var a=s[t]={exports:{}};return i[t](a,a.exports,n),a.exports}n.m=i,n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var a in e)n.o(e,a)&&!n.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},n.f={},n.e=t=>Promise.all(Object.keys(n.f).reduce(((e,a)=>(n.f[a](t,e),e)),[])),n.u=t=>(({25:"startNewChatSession",116:"EndChat",159:"ChatMinimized",345:"initializeAppState",528:"Tooltip",634:"getInitialConversation",733:"Survey",739:"AgentAvailability",753:"ChatWindow",788:"Sound",977:"Chat"}[t]||t)+".es6-cs-CZ_"+n.h().slice(0,8)+".js"),n.h=()=>"a7e4f9a7",n.o=(t,e)=>({}.hasOwnProperty.call(t,e)),e={},a="@allegro/opbox-plugin-chat:",n.l=(t,i,s,r)=>{if(e[t])e[t].push(i);else{var o,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var d=c[h];if(d.getAttribute("src")==t||d.getAttribute("data-webpack")==a+s){o=d;break}}o||(l=!0,(o=document.createElement("script")).type="module",o.charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",a+s),o.src=t,0!==o.src.indexOf(window.location.origin+"/")&&(o.crossOrigin="anonymous")),e[t]=[i];var u=(a,i)=>{o.onerror=o.onload=null,clearTimeout(b);var s=e[t];if(delete e[t],o.parentNode&&o.parentNode.removeChild(o),s&&s.forEach((t=>t(i))),a)return a(i)},b=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),l&&document.head.appendChild(o)}},n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.p="https://assets.allegrostatic.com/sc-14778/",(()=>{var t={57:0};n.f.j=(e,a)=>{var i=n.o(t,e)?t[e]:void 0;if(0!==i)if(i)a.push(i[2]);else{var s=new Promise(((a,s)=>i=t[e]=[a,s]));a.push(i[2]=s);var r=n.p+n.u(e),o=Error();n.l(r,(a=>{if(n.o(t,e)&&(0!==(i=t[e])&&(t[e]=void 0),i)){var s=a&&("load"===a.type?"missing":a.type),r=a&&a.target&&a.target.src;o.message="Loading chunk "+e+" failed.\n("+s+": "+r+")",o.name="ChunkLoadError",o.type=s,o.request=r,i[1](o)}}),"chunk-"+e,e)}};var e=(e,a)=>{var i,s,[r,o,l]=a,c=0;if(r.some((e=>0!==t[e]))){for(i in o)n.o(o,i)&&(n.m[i]=o[i]);l&&l(n)}for(e&&e(a);c<r.length;c++)s=r[c],n.o(t,s)&&t[s]&&t[s][0](),t[s]=0},a=self.webpackJsonp_b2c8c=self.webpackJsonp_b2c8c||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))})();var r=n(7),o=n(0),l=n(3),c=n(8);const h="chatPlugin",d=["chatConfiguration"],u=({config:t=[]})=>{const e=(0,c.a)(),a=t.find((({chatAlias:t,chatInstance:a,conversationWith:i,restrictions:s})=>{if(!t||!a||!i)return!1;if(s){let t=!0;const{languages:a=[],urls:i=[]}=s,n=!!a.length,r=!!i.length;return n&&t&&(t=a.some((t=>t===e))),r&&t&&(t=i.some((({hash:t="",queryParams:e=[]})=>{const a=!!t,i=!!e.length,s=!a||(n=t,window.location.hash.replace("#","")===n.replace("#",""));var n;const r=!i||((t,e)=>{const a=new URLSearchParams(t),i=new URLSearchParams(e);return a.sort(),i.sort(),a.toString()===i.toString()})(window.location.search,e.reduce(((t,e)=>(t[e.key]=e.value,t)),{}));return s&&r}))),t}return!0}));return a?{chatAlias:a.chatAlias,chatInstance:a.chatInstance,conversationWith:a.conversationWith,tooltip:a.tooltip||null}:{chatAlias:"",chatInstance:l.a.Dependent,conversationWith:o.a.None,tooltip:null}};var b=n(1),p=n(9),g=n(10),m=n(2),v=n(12),A=n(4),f=n(5);const S=[/\/moje-allegro\/moje-konto\/centrum-wiadomosci\/wiadomosci(|\/.*)$/gi],C=(()=>{const t=(({pluginName:t,clientImplementationVersion:e})=>{try{return JSON.parse(window.document.querySelector(`script[data-serialize-plugin-name="${t}"][data-civ="${e}"]`).textContent)}catch(a){return window.opbox.reportError(Error(`Missing serialized props of plugin "${t}", with civ "${e}"`)),{}}})({pluginName:h,clientImplementationVersion:"4f7"}),{chatConfiguration:e}=t,a=(0,r.a)(t,d);return Object.assign(Object.assign({},a),{},{chatConfiguration:u(e)})})(),y=new class{constructor(t){this.state=void 0,this.props=void 0,this.agentAvailability=void 0,this.registeredFunctions=void 0,this.setState=t=>{this.state=Object.assign(Object.assign({},this.state),t)},this.loadComponent=(t,e)=>{n.e(977).then(n.bind(n,17)).then((({renderChat:a})=>a(t,e))),this.setState({loaded:!0})},this.props=t,this.state={loaded:!1,chatAgentsAvailable:!1,callbackAsapAgentsAvailable:!1,callbackScheduleAgentsAvailable:!1,callbackAlias:"",chatInProgress:!1,chatAlias:t.chatConfiguration.chatAlias||"",gmsServiceId:""},this.registeredFunctions={closeChatWindow:p.c,endChatSession:p.c,endCallbackSession:p.c,setChatStartedMode:p.c,startCallbackSession:p.c},this.subscribeEvents(),this.initialize()}async initialize(){const{chatInstance:t}=this.props.chatConfiguration;let e=null;if(!(0,A.a)()||!(()=>{const{pathname:t}=window.location;return S.some((e=>null!==t.match(e)))})()){if(this.isPluginInitialized()){const{getInitialConversation:t}=await n.e(634).then(n.bind(n,16));e=await t().catch((()=>null))}if(null!==e){this.state.chatInProgress=!0;const{initializeAppState:t}=await n.e(345).then(n.bind(n,18)),a=t(e,this.props.chatConfiguration);this.loadComponent(a,e),this.registeredFunctions.setChatStartedMode()}else(0,m.a)(),t===l.a.WebView?this.startNewChatSession():this.initializeStandaloneChat()}}subscribeEvents(){f.a.subscribe("startConversation",(t=>{this.updateChatAlias(t),this.startNewChatSession()})),f.a.subscribe("startNewWebViewConversation",(t=>{this.updateChatAlias(t),this.setState({chatInProgress:!1}),this.startNewChatSession()})),f.a.subscribe("closeWindow",(()=>{this.registeredFunctions.closeChatWindow(),this.setState({chatInProgress:!1})})),f.a.subscribe("disconnected",(()=>{this.registeredFunctions.endChatSession(),this.initializeStandaloneChat()}))}initializeStandaloneChat(){const{chatAlias:t,chatInstance:e,conversationWith:a,tooltip:i}=this.props.chatConfiguration,{callbackAlias:s,gmsServiceId:n,loaded:r}=this.state;e===l.a.Standalone&&(a===o.a.Agent&&this.startAgentAvailabilityListener({chatAlias:t,callbackAlias:s,gmsServiceId:n}),r?f.a.emit("updateAppState",{chatAlias:t,chatInstance:e,conversationWith:a,tooltip:i}):this.loadComponent({chatAlias:t,chatInstance:e,conversationWith:a,displayModeState:(0,g.a)(b.a.Minimized),tooltip:i}))}startNewChatSession(t,e){const{chatAlias:a,chatInProgress:i}=this.state;return i?((0,v.a)("Conversation already started."),Promise.resolve()):a?n.e(25).then(n.bind(n,19)).then((({startNewChatSession:a})=>a(this.props,this.state,this.setState,this.loadComponent,t,e))):((0,v.a)(`Conversation wasn't created. Chat alias "${a}" is incorrect.`),Promise.resolve())}updateAliases({callbackAlias:t=this.state.callbackAlias,chatAlias:e=this.state.chatAlias,gmsServiceId:a=this.state.gmsServiceId}){this.setState({callbackAlias:t||"",chatAlias:e||"",gmsServiceId:a||""})}updateAgentAvailability({isCallbackAsapConsultantAvailable:t,isCallbackScheduleConsultantAvailable:e,isConsultantAvailable:a}){this.setState({chatAgentsAvailable:a,callbackScheduleAgentsAvailable:e,callbackAsapAgentsAvailable:t})}isPluginInitialized(){return!("chatConversationProbablyActive"in this.props&&!(0,m.c)())||this.props.chatConversationProbablyActive}startAgentAvailabilityListener(t){var e;if(!t.chatAlias&&!t.callbackAlias)throw Error("No callback and chat aliases.");this.updateAliases(t),null==(e=this.agentAvailability)||e.abort(),n.e(739).then(n.bind(n,20)).then((({AgentAvailability:e})=>{var a;this.agentAvailability=new e((t=>{this.updateAgentAvailability(t),f.a.emit("agentsAvailability",t)})),null==(a=this.agentAvailability)||a.listen({alias:t.chatAlias,callbackAlias:t.callbackAlias,gmsServiceId:t.gmsServiceId})}))}abortAgentAvailability(){var t;null==(t=this.agentAvailability)||t.abort()}registerFunctions(t){this.registeredFunctions=Object.assign(Object.assign({},this.registeredFunctions),t)}updateChatAlias(t=""){this.setState({chatAlias:t})}displayState(t){this.state.chatInProgress||t!==b.a.Normal?Object.values(b.a).includes(t)?f.a.emit("updateDisplayState",t):(0,v.a)("Passed state is incorrect."):(0,v.a)("You can't display chat if conversation isn't started.")}tooltip(t){f.a.emit("updateTooltipVisibility",!!t.visibility)}getPublicApi(){const t={updateChatAlias:this.updateChatAlias.bind(this),startNewChatSession:this.startNewChatSession.bind(this),startAgentsAvailabilityChecker:this.startAgentAvailabilityListener.bind(this),clearInterval:this.abortAgentAvailability.bind(this),registerFunctions:this.registerFunctions.bind(this),displayState:this.displayState.bind(this),tooltip:this.tooltip.bind(this),eventBus:f.a};return Object.defineProperty(t,"chatAgentsAvailable",{get:()=>this.state.chatAgentsAvailable}),Object.defineProperty(t,"chatInProgress",{get:()=>this.state.chatInProgress}),Object.defineProperty(t,"callbackScheduleAgentsAvailable",{get:()=>this.state.callbackScheduleAgentsAvailable}),Object.defineProperty(t,"callbackAsapAgentsAvailable",{get:()=>this.state.callbackAsapAgentsAvailable}),Object.defineProperty(t,"callbackAlias",{get:()=>this.state.callbackAlias}),Object.defineProperty(t,"gmsServiceId",{get:()=>this.state.gmsServiceId}),Object.defineProperty(t,"startCallbackSession",{get:()=>this.registeredFunctions.startCallbackSession.bind(this)}),Object.defineProperty(t,"endCallbackSession",{get:()=>this.registeredFunctions.endCallbackSession.bind(this)}),t}}(C);window.opbox.plugin.register({name:h},y.getPublicApi());
//# sourceMappingURL=index.es6-cs-CZ_a7e4f9a7.js.map